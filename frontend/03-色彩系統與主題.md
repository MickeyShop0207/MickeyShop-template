# 色彩系統與主題

## 系統概覽

**配置驅動的色彩系統**，支援多租戶客製化與即時主題切換。

### 核心特性
- **配置驅動：** 通過環境變數實現客戶品牌客製化
- **主題切換：** 支援淺色/深色主題無縫切換
- **CSS 變數：** 基於 CSS 自定義屬性的響應式色彩系統
- **多租戶支援：** 每個客戶可擁有獨立的色彩配置

## 配置架構整合

### 色彩配置來源
```javascript
// 引用自 config/theme.config.js
import { themeConfig } from '@/config'

const colors = {
  // 主色彩 (可客製化)
  primary: themeConfig.colors.primary,     // 預設: #722F37 (酒紅色)
  secondary: themeConfig.colors.secondary, // 預設: #8B4149 (中酒紅色)
  accent: themeConfig.colors.accent,       // 預設: #1E3A8A (深藍色)
  
  // 功能色彩
  success: themeConfig.colors.success,     // 預設: #52C41A
  warning: themeConfig.colors.warning,     // 預設: #FAAD14
  error: themeConfig.colors.error,         // 預設: #FF4D4F
  info: themeConfig.colors.info,          // 預設: #1677FF
}
```

### CSS 變數生成
```javascript
// 基於配置動態生成 CSS 變數
export const generateThemeVariables = () => {
  const { light, dark, colors } = themeConfig
  
  return {
    light: {
      // 配置驅動的淺色主題
      '--text-primary': light.textPrimary,
      '--text-secondary': light.textSecondary,
      '--text-tertiary': light.textTertiary,
      
      '--bg-page': light.bgPage,
      '--bg-component': light.bgComponent,
      '--bg-hover': light.bgHover,
      '--bg-selected': light.bgSelected,
      
      // 品牌色彩
      '--color-primary': colors.primary,
      '--color-secondary': colors.secondary,
      '--color-accent': colors.accent,
    },
    dark: {
      // 配置驅動的深色主題
      '--text-primary': dark.textPrimary,
      '--text-secondary': dark.textSecondary,
      '--text-tertiary': dark.textTertiary,
      
      '--bg-page': dark.bgPage,
      '--bg-component': dark.bgComponent,
      '--bg-hover': dark.bgHover,
      '--bg-selected': dark.bgSelected,
      
      // 品牌色彩 (深色主題相同)
      '--color-primary': colors.primary,
      '--color-secondary': colors.secondary,
      '--color-accent': colors.accent,
    }
  }
}
```

## 基礎色彩定義

### 環境變數配置
```bash
# .env 檔案中的色彩配置
# 主色彩 (客戶可客製化)
VITE_COLOR_PRIMARY=#722F37
VITE_COLOR_SECONDARY=#8B4149
VITE_COLOR_ACCENT=#1E3A8A

# 淺色主題色彩 - 杏色 + 卡其色系
VITE_LIGHT_BG_PAGE=#FFCDB2
VITE_LIGHT_BG_COMPONENT=#FFFFFF
VITE_LIGHT_BG_HOVER=#F0E68C
VITE_LIGHT_BG_SELECTED=#BDB76B
VITE_LIGHT_TEXT_PRIMARY=#2D1810
VITE_LIGHT_TEXT_SECONDARY=#8B6F47
VITE_LIGHT_TEXT_TERTIARY=#B8A082

# 深色主題色彩 - 酒紅色 + 深藍色系
VITE_DARK_BG_PAGE=#1A0E10
VITE_DARK_BG_COMPONENT=#722F37
VITE_DARK_BG_HOVER=#8B4149
VITE_DARK_BG_SELECTED=#1E3A8A
VITE_DARK_TEXT_PRIMARY=#F5E6D3
VITE_DARK_TEXT_SECONDARY=#D4B896
VITE_DARK_TEXT_TERTIARY=#A68B5B
```

### 淺色主題 CSS 變數
```css
:root[data-theme="light"] {
  /* 文字色彩 - 深棕色系確保對比度 */
  --text-primary: var(--light-text-primary, #2D1810);
  --text-secondary: var(--light-text-secondary, #8B6F47);
  --text-tertiary: var(--light-text-tertiary, #B8A082);
  
  /* 背景色彩 - 杏色 + 卡其色系 */
  --bg-page: var(--light-bg-page, #FFCDB2);
  --bg-component: var(--light-bg-component, #FFFFFF);
  --bg-hover: var(--light-bg-hover, #F0E68C);
  --bg-selected: var(--light-bg-selected, #BDB76B);
  
  /* 品牌色彩 - 酒紅 + 深藍 */
  --color-primary: var(--brand-primary, #722F37);
  --color-secondary: var(--brand-secondary, #8B4149);
  --color-accent: var(--brand-accent, #1E3A8A);
  
  /* 功能色彩 */
  --color-success: #52C41A;
  --color-warning: #FAAD14;
  --color-error: #FF4D4F;
  --color-info: #1677FF;
}
```

### 深色主題 CSS 變數
```css
:root[data-theme="dark"] {
  /* 文字色彩 - 淺色系確保在深色背景上的對比度 */
  --text-primary: var(--dark-text-primary, #F5E6D3);
  --text-secondary: var(--dark-text-secondary, #D4B896);
  --text-tertiary: var(--dark-text-tertiary, #A68B5B);
  
  /* 背景色彩 - 酒紅色 + 深藍色系 */
  --bg-page: var(--dark-bg-page, #1A0E10);
  --bg-component: var(--dark-bg-component, #722F37);
  --bg-hover: var(--dark-bg-hover, #8B4149);
  --bg-selected: var(--dark-bg-selected, #1E3A8A);
  
  /* 品牌色彩 (保持一致) */
  --color-primary: var(--brand-primary, #722F37);
  --color-secondary: var(--brand-secondary, #8B4149);
  --color-accent: var(--brand-accent, #1E3A8A);
  
  /* 功能色彩 (深色主題調整) */
  --color-success: #73D13D;
  --color-warning: #FFC53D;
  --color-error: #FF7875;
  --color-info: #40A9FF;
}
```

## 主題切換系統

### 配置驅動的主題控制
```javascript
// src/hooks/useTheme.js
import { useState, useEffect } from 'react'
import { themeConfig } from '@/config'
import { initializeTheme } from '@/utils/themeInitializer'

export const useTheme = () => {
  const [theme, setTheme] = useState(themeConfig.defaultTheme)
  
  useEffect(() => {
    // 初始化主題變數
    initializeTheme()
    
    // 恢復保存的主題偏好
    const savedTheme = localStorage.getItem('theme-preference') || themeConfig.defaultTheme
    applyTheme(savedTheme)
  }, [])
  
  const applyTheme = (newTheme) => {
    document.documentElement.setAttribute('data-theme', newTheme)
    setTheme(newTheme)
    localStorage.setItem('theme-preference', newTheme)
    
    // 通知其他組件主題變更
    window.dispatchEvent(new CustomEvent('themeChanged', { detail: newTheme }))
  }
  
  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light'
    applyTheme(newTheme)
  }
  
  return { theme, setTheme: applyTheme, toggleTheme }
}
```

### 系統偏好檢測與自動切換
```javascript
// src/utils/themeDetector.js
export const detectSystemTheme = () => {
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    return 'dark'
  }
  return 'light'
}

export const setupSystemThemeListener = (callback) => {
  if (window.matchMedia) {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
    
    const handleChange = (e) => {
      const theme = e.matches ? 'dark' : 'light'
      callback(theme)
    }
    
    mediaQuery.addListener(handleChange)
    
    // 返回清理函數
    return () => mediaQuery.removeListener(handleChange)
  }
}
```

### HTML 屬性控制 (配置優先)
```html
<!-- 基於配置的主題初始化 -->
<html data-theme="{{ themeConfig.defaultTheme }}">
  <head>
    <!-- 主題變數預載入 -->
    <style>
      :root {
        --brand-primary: {{ themeConfig.colors.primary }};
        --brand-secondary: {{ themeConfig.colors.secondary }};
        --brand-accent: {{ themeConfig.colors.accent }};
      }
    </style>
  </head>
  <body>
    <!-- 應用內容 -->
  </body>
</html>
```

## 配置整合實現

### 主題初始化系統
```javascript
// src/utils/themeInitializer.js
import { themeConfig } from '@/config'

// 將配置注入到 CSS 變數中
export const initializeTheme = () => {
  const root = document.documentElement
  const { light, dark, colors } = themeConfig
  
  // 設置品牌色彩變數 (主題無關)
  Object.entries(colors).forEach(([key, value]) => {
    root.style.setProperty(`--brand-${key}`, value)
  })
  
  // 設置淺色主題變數
  Object.entries(light).forEach(([key, value]) => {
    const cssVar = `--light-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`
    root.style.setProperty(cssVar, value)
  })
  
  // 設置深色主題變數
  Object.entries(dark).forEach(([key, value]) => {
    const cssVar = `--dark-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`
    root.style.setProperty(cssVar, value)
  })
  
  // 設置預設主題
  const defaultTheme = themeConfig.defaultTheme
  root.setAttribute('data-theme', defaultTheme)
}
```

### SCSS 檔案結構
```
styles/
├── globals/
│   ├── theme-variables.scss     # 配置驅動的主題變數
│   ├── theme-light.scss         # 淺色主題定義
│   ├── theme-dark.scss          # 深色主題定義
│   └── variables.scss           # 通用變數
└── themes/
    ├── default.scss             # 預設主題
    └── custom.scss              # 客戶自定義主題
```

### theme-variables.scss
```scss
// 基於配置的動態變數定義
:root {
  // 品牌色彩變數 (由 JavaScript 注入)
  --brand-primary: #{map-get($brand-colors, 'primary')};
  --brand-secondary: #{map-get($brand-colors, 'secondary')};
  --brand-accent: #{map-get($brand-colors, 'accent')};
  
  // 主題切換過渡
  --theme-transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
}
```

### theme-light.scss
```scss
// 淺色主題 (使用配置變數)
[data-theme="light"] {
  // 文字色彩
  --text-primary: var(--light-text-primary);
  --text-secondary: var(--light-text-secondary);
  --text-tertiary: var(--light-text-tertiary);
  
  // 背景色彩
  --bg-page: var(--light-bg-page);
  --bg-component: var(--light-bg-component);
  --bg-hover: var(--light-bg-hover);
  --bg-selected: var(--light-bg-selected);
  
  // 品牌色彩引用
  --color-primary: var(--brand-primary);
  --color-secondary: var(--brand-secondary);
  --color-accent: var(--brand-accent);
}
```

### theme-dark.scss
```scss
// 深色主題 (使用配置變數)
[data-theme="dark"] {
  // 文字色彩
  --text-primary: var(--dark-text-primary);
  --text-secondary: var(--dark-text-secondary);
  --text-tertiary: var(--dark-text-tertiary);
  
  // 背景色彩
  --bg-page: var(--dark-bg-page);
  --bg-component: var(--dark-bg-component);
  --bg-hover: var(--dark-bg-hover);
  --bg-selected: var(--dark-bg-selected);
  
  // 品牌色彩引用 (保持一致)
  --color-primary: var(--brand-primary);
  --color-secondary: var(--brand-secondary);
  --color-accent: var(--brand-accent);
}
```

## 組件樣式應用

### CSS Modules使用方式
```scss
/* Button.module.scss */
.button {
  background-color: var(--bg-component);
  color: var(--text-primary);
  border: 1px solid var(--bg-hover);
  
  &:hover {
    background-color: var(--bg-hover);
  }
  
  &:active,
  &.selected {
    background-color: var(--bg-selected);
  }
}
```

### React組件中使用
```jsx
import styles from './Button.module.scss'

const Button = ({ children, selected }) => {
  return (
    <button className={`${styles.button} ${selected ? styles.selected : ''}`}>
      {children}
    </button>
  )
}
```

## 響應式設計支援

### 斷點定義
```scss
// variables.scss
:root {
  --mobile: 425px;
  --tablet: 768px;
  --desktop: 1024px;
  --wide: 1440px;
}
```

### Mixins支援
```scss
// mixins.scss
@mixin mobile {
  @media (min-width: var(--mobile)) { @content; }
}

@mixin tablet {
  @media (min-width: var(--tablet)) { @content; }
}

@mixin desktop {
  @media (min-width: var(--desktop)) { @content; }
}

@mixin wide {
  @media (min-width: var(--wide)) { @content; }
}
```

## 字體系統

### 字體載入
```scss
/* fonts.scss */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+Display:wght@300&display=swap');
@import url('https://cdn.jsdelivr.net/gh/ButTaiwan/iansui@main/webfonts/iansui-regular.css');

:root {
  --font-en: 'Noto Serif Display', serif;
  --font-zh: 'iansui', sans-serif;
  --font-weight-light: 300;
}
```

### 字體應用
```scss
.textEn {
  font-family: var(--font-en);
  font-weight: var(--font-weight-light);
}

.textZh {
  font-family: var(--font-zh);
}
```

## Ant Design 主題整合

### 品牌色彩覆蓋策略
```scss
/* antd-brand-theme.scss */
/* 使用品牌色彩覆蓋 Ant Design 預設樣式 */
:global(.ant-btn-primary) {
  background-color: var(--color-primary) !important;
  border-color: var(--color-primary) !important;
  color: #ffffff !important;
  
  &:hover, &:focus {
    background-color: var(--color-secondary) !important;
    border-color: var(--color-secondary) !important;
  }
  
  &:active {
    background-color: var(--color-accent) !important;
    border-color: var(--color-accent) !important;
  }
}

/* 次要按鈕使用主題背景色 */
:global(.ant-btn-default) {
  background-color: var(--bg-component) !important;
  border-color: var(--bg-hover) !important;
  color: var(--text-primary) !important;
  
  &:hover, &:focus {
    background-color: var(--bg-hover) !important;
    border-color: var(--color-primary) !important;
    color: var(--color-primary) !important;
  }
}

/* 危險按鈕使用功能色 */
:global(.ant-btn-danger) {
  background-color: var(--color-error) !important;
  border-color: var(--color-error) !important;
  
  &:hover, &:focus {
    background-color: #ff7875 !important;
    border-color: #ff7875 !important;
  }
}
```

### 主題自適應覆蓋
```scss
/* antd-theme-adaptive.scss */
/* 根據主題自動調整 Ant Design 組件 */
:global {
  // 輸入框主題適應
  .ant-input, .ant-input-affix-wrapper {
    background-color: var(--bg-component) !important;
    border-color: var(--bg-hover) !important;
    color: var(--text-primary) !important;
    
    &:focus, &:focus-within {
      border-color: var(--color-primary) !important;
      box-shadow: 0 0 0 2px rgba(from var(--color-primary) r g b / 0.1) !important;
    }
  }
  
  // 下拉選單主題適應
  .ant-select-selector {
    background-color: var(--bg-component) !important;
    border-color: var(--bg-hover) !important;
    color: var(--text-primary) !important;
  }
  
  .ant-select-dropdown {
    background-color: var(--bg-component) !important;
    border: 1px solid var(--bg-hover) !important;
    
    .ant-select-item {
      color: var(--text-primary) !important;
      
      &:hover {
        background-color: var(--bg-hover) !important;
      }
      
      &.ant-select-item-option-selected {
        background-color: var(--color-primary) !important;
        color: #ffffff !important;
      }
    }
  }
  
  // 模態框主題適應
  .ant-modal-content {
    background-color: var(--bg-component) !important;
    
    .ant-modal-header {
      background-color: var(--bg-component) !important;
      border-bottom-color: var(--bg-hover) !important;
      
      .ant-modal-title {
        color: var(--text-primary) !important;
      }
    }
    
    .ant-modal-body {
      color: var(--text-primary) !important;
    }
    
    .ant-modal-footer {
      background-color: var(--bg-component) !important;
      border-top-color: var(--bg-hover) !important;
    }
  }
}
```

## 主題切換動畫

### 過渡效果
```scss
:root {
  --theme-transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
}

* {
  transition: var(--theme-transition);
}
```

## 多租戶使用指南

### 在 React 組件中使用
```jsx
// 使用主題 Hook
import { useTheme } from '@/hooks/useTheme'
import { themeConfig } from '@/config'

const ProductCard = () => {
  const { theme, toggleTheme } = useTheme()
  
  return (
    <div className="product-card">
      <h3 style={{ color: `var(--color-primary)` }}>
        {themeConfig.brand.name}
      </h3>
      
      <button 
        className="theme-toggle"
        onClick={toggleTheme}
        aria-label={`切換到${theme === 'light' ? '暗' : '亮'}色主題`}
      >
        {theme === 'light' ? '🌙' : '☀️'}
      </button>
    </div>
  )
}
```

### SCSS Modules 中使用
```scss
// ProductCard.module.scss
.productCard {
  background-color: var(--bg-component);
  border: 1px solid var(--bg-hover);
  border-radius: 8px;
  padding: 1rem;
  transition: var(--theme-transition);
  
  h3 {
    color: var(--color-primary);
    margin-bottom: 0.5rem;
  }
  
  .description {
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }
  
  .price {
    color: var(--color-accent);
    font-weight: 600;
    font-size: 1.2rem;
  }
  
  &:hover {
    background-color: var(--bg-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(from var(--color-primary) r g b / 0.15);
  }
}

.themeToggle {
  position: fixed;
  top: 1rem;
  right: 1rem;
  background: var(--bg-component);
  border: 1px solid var(--bg-hover);
  border-radius: 50%;
  width: 48px;
  height: 48px;
  cursor: pointer;
  transition: var(--theme-transition);
  
  &:hover {
    background-color: var(--color-primary);
    transform: scale(1.1);
  }
}
```

### 客戶客製化流程
```bash
# 1. 複製範本專案
git clone <template-repo>
cd beauty-ecommerce-template

# 2. 安裝依賴
npm install

# 3. 配置環境變數
cp .env.example .env

# 編輯 .env 檔案
VITE_BRAND_NAME="Your Brand Name"
VITE_COLOR_PRIMARY="#722F37"  # 酒紅色
VITE_COLOR_SECONDARY="#8B4149"  # 中酒紅色  
VITE_COLOR_ACCENT="#1E3A8A"  # 深藍色
# ... 其他配置

# 4. 啟動開發伺服器
npm run dev

# 5. 構建生產版本
npm run build

# 6. 部署到 Cloudflare Pages
# (通過 GitHub/GitLab 整合或手動上傳)
```

## 無障礙設計與品質保證

### 對比度確保
- **淺色主題**: 文字對比度 4.5:1 以上 (WCAG AA 標準)
- **深色主題**: 文字對比度 4.5:1 以上
- **互動元素**: 明確的視覺回饋與狀態變化
- **焦點指示**: 鍵盤導航支援

### 系統偏好整合
```scss
// 自動檢測系統主題偏好
@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    // 當用戶沒有手動設定主題時，自動使用暗色主題
    --text-primary: var(--dark-text-primary);
    --bg-page: var(--dark-bg-page);
    --bg-component: var(--dark-bg-component);
    // ... 其他暗色主題變數
  }
}

@media (prefers-reduced-motion: reduce) {
  // 為動作敏感用戶減少動畫
  :root {
    --theme-transition: none;
  }
  
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

### 色彩系統驗證
```javascript
// src/utils/colorValidator.js
import { themeConfig } from '@/config'

// 驗證色彩對比度
export const validateColorContrast = (foreground, background) => {
  // WCAG 對比度計算逻輯
  // 返回 true/false 和對比比例
}

// 驗證主題配置的無障礙性
export const validateThemeAccessibility = () => {
  const results = {
    lightTheme: {},
    darkTheme: {},
    overall: { passed: true, issues: [] }
  }
  
  // 檢查淺色主題對比度
  results.lightTheme = {
    textOnPage: validateColorContrast(
      themeConfig.light.textPrimary, 
      themeConfig.light.bgPage
    ),
    textOnComponent: validateColorContrast(
      themeConfig.light.textPrimary, 
      themeConfig.light.bgComponent
    )
  }
  
  // 檢查暗色主題對比度
  results.darkTheme = {
    textOnPage: validateColorContrast(
      themeConfig.dark.textPrimary, 
      themeConfig.dark.bgPage
    ),
    textOnComponent: validateColorContrast(
      themeConfig.dark.textPrimary, 
      themeConfig.dark.bgComponent
    )
  }
  
  return results
}
```