# 儀表板模組 (Operations Dashboard System)

## 模組概述
儀表板是電商後台的運營指揮中心，專注於顯示需要立即處理的待辦事項、簽核流程、異常警報和關鍵運營指標。與數據分析模組不同，儀表板強調實時性、可操作性和任務導向，確保管理者能快速掌握營運狀況並採取行動。

## 核心設計理念

### 1. 儀表板與數據分析的區別
```typescript
// 儀表板特性
interface DashboardCharacteristics {
  focus: 'operational_tasks';           // 專注於可操作任務
  time_sensitivity: 'real_time';        // 實時性要求
  user_interaction: 'action_oriented';  // 行動導向
  information_depth: 'summary_level';   // 摘要層級資訊
  update_frequency: 'continuous';       // 持續更新
  target_audience: 'daily_operators';   // 日常營運人員
}

// 數據分析特性
interface AnalyticsCharacteristics {
  focus: 'insights_and_trends';         // 專注於洞察和趨勢
  time_sensitivity: 'periodic';         // 週期性分析
  user_interaction: 'exploration';      // 探索性分析
  information_depth: 'detailed_analysis'; // 詳細分析層級
  update_frequency: 'scheduled';        // 排程更新
  target_audience: 'decision_makers';   // 決策制定者
}
```

## 待辦事項管理系統

### 1. 統一待辦事項架構
```typescript
enum TaskType {
  // 庫存相關
  INVENTORY_LOW_STOCK = 'inventory_low_stock',           // 低庫存提醒
  INVENTORY_OUT_OF_STOCK = 'inventory_out_of_stock',     // 缺貨提醒
  INVENTORY_OVERSTOCK = 'inventory_overstock',           // 庫存過量提醒
  INVENTORY_ADJUSTMENT_NEEDED = 'inventory_adjustment_needed', // 庫存調整需求
  
  // 採購相關
  PURCHASE_ORDER_APPROVAL = 'purchase_order_approval',   // 採購單待簽核
  SUPPLIER_PAYMENT_DUE = 'supplier_payment_due',        // 供應商付款到期
  GOODS_RECEIPT_PENDING = 'goods_receipt_pending',       // 待收貨
  SUPPLIER_PERFORMANCE_REVIEW = 'supplier_performance_review', // 供應商績效審查
  
  // 訂單相關
  ORDER_MANUAL_REVIEW = 'order_manual_review',          // 訂單人工審核
  ORDER_PAYMENT_CONFIRMATION = 'order_payment_confirmation', // 付款確認
  ORDER_SHIPPING_DELAY = 'order_shipping_delay',        // 出貨延遲
  ORDER_RETURN_APPROVAL = 'order_return_approval',      // 退貨申請審核
  ORDER_REFUND_PROCESSING = 'order_refund_processing',  // 退款處理
  
  // 客服相關
  CUSTOMER_COMPLAINT_HIGH_PRIORITY = 'customer_complaint_high_priority', // 高優先級客訴
  CUSTOMER_INQUIRY_OVERDUE = 'customer_inquiry_overdue', // 逾期客戶詢問
  REVIEW_MODERATION = 'review_moderation',               // 評價審核
  
  // 行銷相關
  CAMPAIGN_APPROVAL = 'campaign_approval',               // 行銷活動審核
  COUPON_EXPIRY_WARNING = 'coupon_expiry_warning',      // 優惠券即將到期
  CONTENT_APPROVAL = 'content_approval',                // 內容審核
  SOCIAL_MEDIA_RESPONSE = 'social_media_response',      // 社群媒體回應
  
  // 財務相關
  INVOICE_APPROVAL = 'invoice_approval',                 // 發票審核
  EXPENSE_APPROVAL = 'expense_approval',                // 費用審核
  BUDGET_VARIANCE_REVIEW = 'budget_variance_review',    // 預算差異審查
  RECONCILIATION_DISCREPANCY = 'reconciliation_discrepancy', // 對帳差異
  
  // 系統相關
  SYSTEM_MAINTENANCE_SCHEDULED = 'system_maintenance_scheduled', // 系統維護排程
  SECURITY_ALERT = 'security_alert',                    // 安全警報
  DATA_BACKUP_FAILED = 'data_backup_failed',           // 資料備份失敗
  PERFORMANCE_DEGRADATION = 'performance_degradation',  // 系統效能降級
  
  // 人員相關
  STAFF_APPROVAL_REQUEST = 'staff_approval_request',    // 人員審核請求
  SCHEDULE_CONFLICT = 'schedule_conflict',              // 排班衝突
  TRAINING_DUE = 'training_due',                        // 培訓到期
  
  // 合規相關
  COMPLIANCE_AUDIT_DUE = 'compliance_audit_due',        // 合規稽核到期
  LICENSE_RENEWAL = 'license_renewal',                  // 執照更新
  POLICY_UPDATE_REQUIRED = 'policy_update_required'     // 政策更新需求
}

interface TaskItem {
  id: number;
  task_type: TaskType;
  title: string;                        // 任務標題
  description: string;                  // 任務描述
  priority: TaskPriority;               // 優先級
  status: TaskStatus;                   // 狀態
  
  // 關聯資訊
  related_module: string;               // 關聯模組
  related_entity_type: string;         // 關聯實體類型
  related_entity_id: number;           // 關聯實體ID
  
  // 負責人資訊
  assigned_to?: number;                 // 指派給誰
  assigned_by?: number;                 // 誰指派的
  assigned_at?: Date;                   // 指派時間
  
  // 時間管理
  due_date?: Date;                      // 到期時間
  estimated_duration?: number;          // 預估處理時間（分鐘）
  started_at?: Date;                    // 開始處理時間
  completed_at?: Date;                  // 完成時間
  
  // 業務邏輯
  business_impact: BusinessImpact;      // 業務影響程度
  auto_escalation_rules?: {
    escalate_after_hours: number;
    escalate_to: number[];
    escalation_message: string;
  };
  
  // 操作快捷
  quick_actions: TaskQuickAction[];     // 快速操作
  related_documents?: string[];         // 相關文件
  
  // 追蹤資訊
  created_at: Date;
  updated_at: Date;
  reminder_sent_at?: Date;              // 提醒發送時間
  view_count: number;                   // 檢視次數
  
  // 自定義欄位
  custom_fields?: { [key: string]: any };
}

enum TaskPriority {
  CRITICAL = 'critical',               // 緊急（紅色）
  HIGH = 'high',                       // 高（橙色）
  MEDIUM = 'medium',                   // 中（黃色）
  LOW = 'low',                         // 低（綠色）
  INFO = 'info'                        // 資訊（藍色）
}

enum TaskStatus {
  PENDING = 'pending',                 // 待處理
  IN_PROGRESS = 'in_progress',         // 處理中
  WAITING_FOR_APPROVAL = 'waiting_for_approval', // 等待審核
  APPROVED = 'approved',               // 已核准
  REJECTED = 'rejected',               // 已拒絕
  COMPLETED = 'completed',             // 已完成
  CANCELLED = 'cancelled',             // 已取消
  ESCALATED = 'escalated'              // 已升級
}

enum BusinessImpact {
  REVENUE_CRITICAL = 'revenue_critical',     // 營收關鍵
  CUSTOMER_CRITICAL = 'customer_critical',   // 客戶關鍵
  OPERATIONAL_CRITICAL = 'operational_critical', // 營運關鍵
  COMPLIANCE_CRITICAL = 'compliance_critical', // 合規關鍵
  MODERATE_IMPACT = 'moderate_impact',       // 中度影響
  LOW_IMPACT = 'low_impact'                  // 低度影響
}

interface TaskQuickAction {
  action_type: 'approve' | 'reject' | 'assign' | 'defer' | 'complete' | 'escalate' | 'view_detail';
  action_label: string;
  action_url?: string;
  confirmation_required: boolean;
  permission_required?: string;
}
```

### 2. 智能任務生成系統
```typescript
interface TaskGenerationRule {
  id: number;
  rule_name: string;
  module: string;                       // 來源模組
  trigger_condition: string;            // 觸發條件
  task_template: TaskTemplate;          // 任務模板
  
  // 觸發設定
  trigger_type: 'event' | 'schedule' | 'threshold' | 'manual';
  trigger_frequency?: string;           // 排程頻率
  trigger_parameters: any;              // 觸發參數
  
  // 分配規則
  assignment_rules: {
    default_assignee?: number;
    assignment_logic: 'round_robin' | 'workload_based' | 'skill_based' | 'manual';
    backup_assignees?: number[];
  };
  
  // 升級規則
  escalation_enabled: boolean;
  escalation_hours: number;
  escalation_chain: number[];
  
  is_active: boolean;
  created_at: Date;
  updated_at: Date;
}

interface TaskTemplate {
  title_template: string;               // 標題模板
  description_template: string;         // 描述模板
  priority: TaskPriority;
  business_impact: BusinessImpact;
  estimated_duration: number;
  due_date_offset_hours?: number;       // 到期時間偏移
  quick_actions: TaskQuickAction[];
  required_permissions: string[];
}

// 預設任務生成規則
const DefaultTaskRules = {
  // 庫存低於安全庫存
  low_stock_alert: {
    rule_name: '低庫存提醒',
    module: 'inventory',
    trigger_condition: 'current_stock <= safety_stock',
    task_template: {
      title_template: '商品 {product_name} 庫存不足',
      description_template: '當前庫存：{current_stock}，安全庫存：{safety_stock}，建議補貨數量：{suggested_quantity}',
      priority: 'high',
      business_impact: 'revenue_critical',
      estimated_duration: 15,
      due_date_offset_hours: 24
    }
  },
  
  // 採購單待審核
  purchase_order_approval: {
    rule_name: '採購單審核',
    module: 'procurement',
    trigger_condition: 'purchase_order.status == "pending_approval"',
    task_template: {
      title_template: '採購單 #{order_number} 待審核',
      description_template: '供應商：{supplier_name}，總金額：{total_amount}，預期交期：{expected_delivery_date}',
      priority: 'medium',
      business_impact: 'operational_critical',
      estimated_duration: 30
    }
  },
  
  // 訂單異常
  order_manual_review: {
    rule_name: '訂單人工審核',
    module: 'orders',
    trigger_condition: 'order.risk_score > 70 OR order.manual_review_required == true',
    task_template: {
      title_template: '訂單 #{order_number} 需要人工審核',
      description_template: '風險評分：{risk_score}，異常原因：{risk_reasons}，訂單金額：{total_amount}',
      priority: 'high',
      business_impact: 'customer_critical',
      estimated_duration: 20
    }
  },
  
  // 客戶投訴
  customer_complaint: {
    rule_name: '客戶投訴處理',
    module: 'customer_service',
    trigger_condition: 'ticket.priority == "high" AND ticket.type == "complaint"',
    task_template: {
      title_template: '高優先級客戶投訴 #{ticket_number}',
      description_template: '客戶：{customer_name}，投訴類型：{complaint_type}，訂單：#{order_number}',
      priority: 'critical',
      business_impact: 'customer_critical',
      estimated_duration: 45,
      due_date_offset_hours: 2
    }
  }
};
```

## 簽核流程管理

### 3. 多層次簽核系統
```typescript
interface ApprovalWorkflow {
  id: number;
  workflow_name: string;
  module: string;                       // 適用模組
  entity_type: string;                  // 實體類型
  
  // 觸發條件
  trigger_conditions: {
    field: string;
    operator: string;
    value: any;
    condition_type: 'and' | 'or';
  }[];
  
  // 簽核步驟
  approval_steps: ApprovalStep[];
  
  // 流程設定
  allow_parallel_approval: boolean;     // 允許並行簽核
  require_all_approvers: boolean;       // 需要所有簽核者同意
  allow_self_approval: boolean;         // 允許自己簽核
  auto_approve_conditions?: any[];      // 自動核准條件
  
  // 通知設定
  notification_settings: {
    notify_on_submit: boolean;
    notify_on_approve: boolean;
    notify_on_reject: boolean;
    reminder_frequency_hours: number;
    escalation_after_hours: number;
  };
  
  is_active: boolean;
  created_at: Date;
  updated_at: Date;
}

interface ApprovalStep {
  step_order: number;
  step_name: string;
  step_type: 'single_approver' | 'multiple_approvers' | 'role_based' | 'condition_based';
  
  // 簽核者設定
  approvers: ApproverConfig[];
  
  // 步驟邏輯
  approval_logic: 'any_one' | 'majority' | 'unanimous' | 'weighted';
  required_approvals: number;           // 需要的簽核數量
  
  // 條件設定
  skip_conditions?: any[];              // 跳過條件
  auto_approve_conditions?: any[];      // 自動核准條件
  
  // 時間設定
  sla_hours?: number;                   // 服務水準時間
  escalation_hours?: number;            // 升級時間
  escalation_approvers?: number[];      // 升級簽核者
  
  // 操作設定
  allow_delegation: boolean;            // 允許委派
  require_comments: boolean;            // 需要評論
  attachment_required: boolean;         // 需要附件
}

interface ApproverConfig {
  approver_type: 'user' | 'role' | 'department' | 'dynamic';
  approver_id?: number;                 // 用戶ID
  role_name?: string;                   // 角色名稱
  department_id?: number;               // 部門ID
  dynamic_logic?: string;               // 動態邏輯
  weight?: number;                      // 權重（用於加權投票）
}

interface ApprovalInstance {
  id: number;
  workflow_id: number;
  entity_type: string;
  entity_id: number;
  
  // 申請資訊
  submitted_by: number;
  submitted_at: Date;
  submission_notes?: string;
  
  // 流程狀態
  current_step: number;
  overall_status: 'pending' | 'in_progress' | 'approved' | 'rejected' | 'cancelled';
  
  // 簽核記錄
  approval_history: ApprovalAction[];
  
  // 時間追蹤
  due_date?: Date;
  completed_at?: Date;
  total_processing_time?: number;       // 總處理時間（分鐘）
  
  // 附加資訊
  priority: TaskPriority;
  business_impact: BusinessImpact;
  risk_level?: 'low' | 'medium' | 'high';
  
  created_at: Date;
  updated_at: Date;
}

interface ApprovalAction {
  id: number;
  approval_instance_id: number;
  step_number: number;
  
  // 簽核者資訊
  approver_id: number;
  approver_name: string;
  approver_role: string;
  
  // 簽核結果
  action: 'approve' | 'reject' | 'delegate' | 'request_info' | 'escalate';
  decision_date: Date;
  comments?: string;
  attachments?: string[];
  
  // 委派資訊
  delegated_to?: number;
  delegation_reason?: string;
  
  // 系統資訊
  ip_address?: string;
  user_agent?: string;
  processing_time_minutes: number;
  
  created_at: Date;
}

// 預設簽核流程
const DefaultApprovalWorkflows = {
  // 採購單簽核
  purchase_order_approval: {
    workflow_name: '採購單簽核流程',
    module: 'procurement',
    entity_type: 'purchase_order',
    trigger_conditions: [
      { field: 'total_amount', operator: '>', value: 10000 }
    ],
    approval_steps: [
      {
        step_order: 1,
        step_name: '直屬主管簽核',
        step_type: 'role_based',
        approvers: [{ approver_type: 'role', role_name: 'procurement_manager' }],
        approval_logic: 'any_one',
        sla_hours: 24
      },
      {
        step_order: 2,
        step_name: '財務主管簽核',
        step_type: 'role_based',
        approvers: [{ approver_type: 'role', role_name: 'finance_manager' }],
        approval_logic: 'any_one',
        sla_hours: 48,
        skip_conditions: [
          { field: 'total_amount', operator: '<', value: 50000 }
        ]
      },
      {
        step_order: 3,
        step_name: '總經理簽核',
        step_type: 'role_based',
        approvers: [{ approver_type: 'role', role_name: 'general_manager' }],
        approval_logic: 'any_one',
        sla_hours: 72,
        skip_conditions: [
          { field: 'total_amount', operator: '<', value: 100000 }
        ]
      }
    ]
  },
  
  // 退款簽核
  refund_approval: {
    workflow_name: '退款簽核流程',
    module: 'orders',
    entity_type: 'refund_request',
    trigger_conditions: [
      { field: 'refund_amount', operator: '>', value: 5000 }
    ],
    approval_steps: [
      {
        step_order: 1,
        step_name: '客服主管簽核',
        step_type: 'role_based',
        approvers: [{ approver_type: 'role', role_name: 'customer_service_manager' }],
        approval_logic: 'any_one',
        sla_hours: 8
      }
    ]
  }
};
```

## 實時監控儀表板

### 4. 關鍵營運指標監控
```typescript
interface OperationalMetrics {
  // === 即時營運指標 ===
  real_time_metrics: {
    current_timestamp: Date;
    
    // 訂單相關
    orders_today: {
      total_orders: number;
      pending_orders: number;
      processing_orders: number;
      shipped_orders: number;
      revenue_today: number;
      avg_order_value: number;
    };
    
    // 庫存相關
    inventory_alerts: {
      low_stock_items: number;
      out_of_stock_items: number;
      overstock_items: number;
      total_inventory_value: number;
    };
    
    // 客服相關
    customer_service: {
      open_tickets: number;
      overdue_tickets: number;
      avg_response_time_minutes: number;
      customer_satisfaction_today: number;
    };
    
    // 網站表現
    website_performance: {
      current_visitors: number;
      conversion_rate_today: number;
      bounce_rate_today: number;
      page_load_time_avg: number;
      uptime_percentage: number;
    };
    
    // 財務相關
    financial_summary: {
      revenue_today: number;
      profit_today: number;
      outstanding_payments: number;
      overdue_invoices: number;
      cash_flow_status: 'positive' | 'negative' | 'neutral';
    };
  };
  
  // === 營運效率指標 ===
  operational_efficiency: {
    // 處理效率
    processing_efficiency: {
      orders_processed_per_hour: number;
      avg_order_processing_time_minutes: number;
      orders_requiring_manual_review_percentage: number;
      automatic_processing_rate: number;
    };
    
    // 庫存效率
    inventory_efficiency: {
      inventory_turnover_rate: number;
      stockout_rate_percentage: number;
      excess_inventory_percentage: number;
      inventory_accuracy_rate: number;
    };
    
    // 客服效率
    service_efficiency: {
      first_contact_resolution_rate: number;
      avg_ticket_resolution_time_hours: number;
      agent_utilization_rate: number;
      customer_effort_score: number;
    };
    
    // 供應鏈效率
    supply_chain_efficiency: {
      supplier_on_time_delivery_rate: number;
      procurement_cycle_time_days: number;
      supplier_defect_rate: number;
      inventory_receiving_accuracy: number;
    };
  };
  
  // === 異常監控 ===
  anomaly_monitoring: {
    active_anomalies: {
      anomaly_id: number;
      metric_name: string;
      severity: 'low' | 'medium' | 'high' | 'critical';
      detected_at: Date;
      description: string;
      recommended_action: string;
      status: 'open' | 'investigating' | 'resolved';
    }[];
    
    system_health: {
      database_response_time: number;
      api_response_time: number;
      error_rate_percentage: number;
      queue_processing_status: 'healthy' | 'warning' | 'critical';
    };
    
    business_health: {
      conversion_rate_status: 'normal' | 'below_average' | 'concerning';
      customer_satisfaction_trend: 'improving' | 'stable' | 'declining';
      inventory_health_score: number;          // 0-100
      financial_health_score: number;          // 0-100
    };
  };
  
  // === 預警系統 ===
  alert_system: {
    critical_alerts: {
      alert_id: number;
      alert_type: string;
      priority: TaskPriority;
      message: string;
      affected_area: string;
      estimated_impact: string;
      suggested_actions: string[];
      created_at: Date;
      acknowledged_by?: number;
      resolved_at?: Date;
    }[];
    
    trending_issues: {
      issue_pattern: string;
      occurrence_count: number;
      trend_direction: 'increasing' | 'stable' | 'decreasing';
      risk_assessment: 'low' | 'medium' | 'high';
      prevention_recommendations: string[];
    }[];
  };
}
```

### 5. 個人化儀表板設定
```typescript
interface DashboardConfiguration {
  user_id: number;
  dashboard_name: string;
  is_default: boolean;
  
  // 佈局設定
  layout_config: {
    grid_columns: number;
    grid_rows: number;
    responsive_breakpoints: any;
  };
  
  // 小工具設定
  widgets: DashboardWidget[];
  
  // 篩選設定
  global_filters: {
    date_range?: { start: Date; end: Date };
    department_filter?: string[];
    module_filter?: string[];
    priority_filter?: TaskPriority[];
  };
  
  // 自動重整設定
  auto_refresh: {
    enabled: boolean;
    interval_seconds: number;
    refresh_on_focus: boolean;
  };
  
  // 通知設定
  notification_preferences: {
    desktop_notifications: boolean;
    sound_alerts: boolean;
    email_digest: boolean;
    digest_frequency: 'hourly' | 'daily' | 'weekly';
  };
  
  created_at: Date;
  updated_at: Date;
}

interface DashboardWidget {
  widget_id: string;
  widget_type: WidgetType;
  title: string;
  position: { x: number; y: number; width: number; height: number };
  
  // 資料源設定
  data_source: string;
  data_parameters: any;
  refresh_interval_seconds: number;
  
  // 顯示設定
  display_options: {
    show_title: boolean;
    show_legend: boolean;
    color_scheme: string;
    chart_type?: string;
  };
  
  // 互動設定
  click_actions: {
    action_type: 'navigate' | 'modal' | 'external_link' | 'quick_action';
    target: string;
    parameters?: any;
  }[];
  
  // 權限設定
  required_permissions: string[];
  
  is_visible: boolean;
  created_at: Date;
  updated_at: Date;
}

enum WidgetType {
  // 任務相關
  TASK_LIST = 'task_list',                     // 任務清單
  TASK_COUNT = 'task_count',                   // 任務計數
  APPROVAL_QUEUE = 'approval_queue',           // 簽核佇列
  
  // 指標相關
  KPI_METRIC = 'kpi_metric',                   // KPI指標
  METRIC_CHART = 'metric_chart',               // 指標圖表
  GAUGE_CHART = 'gauge_chart',                 // 儀表圖
  
  // 狀態相關
  STATUS_INDICATOR = 'status_indicator',       // 狀態指示器
  HEALTH_CHECK = 'health_check',               // 健康檢查
  ALERT_PANEL = 'alert_panel',                 // 警報面板
  
  // 列表相關
  DATA_TABLE = 'data_table',                   // 資料表格
  RECENT_ACTIVITY = 'recent_activity',         // 最近活動
  TOP_PERFORMERS = 'top_performers',           // 表現排行
  
  // 圖表相關
  LINE_CHART = 'line_chart',                   // 線圖
  BAR_CHART = 'bar_chart',                     // 長條圖
  PIE_CHART = 'pie_chart',                     // 圓餅圖
  AREA_CHART = 'area_chart',                   // 面積圖
  
  // 自定義
  CUSTOM_HTML = 'custom_html',                 // 自定義HTML
  IFRAME = 'iframe',                           // 嵌入頁面
  NEWS_FEED = 'news_feed'                      // 新聞動態
}
```

## 智能提醒系統

### 6. 多層次提醒機制
```typescript
interface SmartReminderSystem {
  // === 提醒規則引擎 ===
  reminder_rules: {
    rule_id: number;
    rule_name: string;
    trigger_type: 'time_based' | 'event_based' | 'threshold_based' | 'pattern_based';
    
    // 觸發條件
    conditions: {
      field: string;
      operator: string;
      value: any;
      evaluation_frequency: 'real_time' | 'hourly' | 'daily';
    }[];
    
    // 提醒設定
    reminder_config: {
      initial_delay_minutes: number;
      reminder_intervals: number[];        // 提醒間隔（分鐘）
      max_reminders: number;
      escalation_enabled: boolean;
      escalation_after_reminders: number;
      escalation_recipients: number[];
    };
    
    // 通知方式
    notification_channels: ('email' | 'sms' | 'push' | 'in_app' | 'slack')[];
    
    // 訊息模板
    message_templates: {
      subject_template: string;
      body_template: string;
      urgency_indicators: boolean;
      personalization_enabled: boolean;
    };
  }[];
  
  // === 智能提醒排程 ===
  smart_scheduling: {
    // 工作時間考量
    respect_working_hours: boolean;
    working_hours: { start: string; end: string };
    working_days: number[];              // 0=Sunday, 1=Monday, etc.
    timezone: string;
    
    // 個人偏好
    user_preferences: {
      user_id: number;
      preferred_notification_times: string[];
      do_not_disturb_periods: { start: string; end: string }[];
      channel_preferences: { channel: string; priority: number }[];
      max_notifications_per_day: number;
    }[];
    
    // 智能調度
    adaptive_scheduling: {
      learn_from_user_behavior: boolean;
      optimal_timing_algorithm: 'ml_based' | 'rule_based';
      response_rate_optimization: boolean;
    };
  };
  
  // === 提醒個人化 ===
  personalization: {
    content_personalization: {
      include_user_name: boolean;
      include_relevant_context: boolean;
      language_localization: boolean;
      tone_adjustment: 'formal' | 'casual' | 'urgent';
    };
    
    priority_adjustment: {
      user_role_based_priority: boolean;
      workload_aware_priority: boolean;
      historical_response_based: boolean;
    };
    
    frequency_optimization: {
      adaptive_frequency: boolean;
      user_engagement_tracking: boolean;
      fatigue_prevention: boolean;
    };
  };
  
  // === 提醒效果追蹤 ===
  effectiveness_tracking: {
    metrics: {
      delivery_rate: number;
      open_rate: number;
      click_through_rate: number;
      action_completion_rate: number;
      response_time_average: number;
    };
    
    user_feedback: {
      usefulness_score: number;          // 1-5
      timing_appropriateness: number;    // 1-5
      frequency_satisfaction: number;    // 1-5
      channel_preference_accuracy: number; // 1-5
    };
    
    continuous_improvement: {
      a_b_testing_enabled: boolean;
      automatic_optimization: boolean;
      feedback_incorporation: boolean;
    };
  };
}
```

## API 設計規格

### 7. 儀表板API設計
```typescript
// === 待辦事項API ===
// 取得任務清單
GET /api/admin/dashboard/tasks
Query: {
  status?: TaskStatus[];
  priority?: TaskPriority[];
  task_type?: TaskType[];
  assigned_to?: number;
  due_date_start?: string;
  due_date_end?: string;
  business_impact?: BusinessImpact[];
  page?: number;
  limit?: number;
  sort?: string;
  order?: 'asc' | 'desc';
}

// 更新任務狀態
PATCH /api/admin/dashboard/tasks/{task_id}/status
Body: {
  status: TaskStatus;
  notes?: string;
  estimated_completion?: Date;
}

// 指派任務
POST /api/admin/dashboard/tasks/{task_id}/assign
Body: {
  assigned_to: number;
  priority?: TaskPriority;
  due_date?: Date;
  notes?: string;
}

// 批量處理任務
POST /api/admin/dashboard/tasks/batch
Body: {
  task_ids: number[];
  action: 'complete' | 'assign' | 'defer' | 'escalate';
  parameters?: any;
}

// === 簽核流程API ===
// 取得待簽核項目
GET /api/admin/dashboard/approvals
Query: {
  workflow_type?: string;
  priority?: TaskPriority[];
  submitted_by?: number;
  due_date_filter?: 'overdue' | 'due_today' | 'due_this_week';
  my_approvals_only?: boolean;
}

// 執行簽核動作
POST /api/admin/dashboard/approvals/{approval_id}/action
Body: {
  action: 'approve' | 'reject' | 'delegate' | 'request_info';
  comments?: string;
  attachments?: string[];
  delegate_to?: number;
}

// 批量簽核
POST /api/admin/dashboard/approvals/batch-approve
Body: {
  approval_ids: number[];
  action: 'approve' | 'reject';
  comments?: string;
}

// === 實時指標API ===
// 取得即時營運指標
GET /api/admin/dashboard/metrics/real-time
Query: {
  metrics?: string[];                  // 指定要取得的指標
  include_trends?: boolean;
  time_range?: string;                 // 'today', 'this_week', 'this_month'
}

// 取得營運效率指標
GET /api/admin/dashboard/metrics/efficiency
Query: {
  categories?: string[];               // processing, inventory, service, supply_chain
  comparison_period?: string;          // 比較期間
}

// 取得異常監控
GET /api/admin/dashboard/anomalies
Query: {
  severity?: string[];
  status?: string[];
  time_range?: string;
  include_recommendations?: boolean;
}

// === 儀表板設定API ===
// 取得儀表板設定
GET /api/admin/dashboard/config
Query: {
  dashboard_name?: string;
  include_widgets?: boolean;
}

// 更新儀表板設定
PUT /api/admin/dashboard/config
Body: {
  dashboard_name: string;
  layout_config: any;
  widgets: DashboardWidget[];
  global_filters: any;
  auto_refresh: any;
}

// 新增/更新小工具
POST /api/admin/dashboard/widgets
Body: DashboardWidget

PUT /api/admin/dashboard/widgets/{widget_id}
Body: Partial<DashboardWidget>

// 取得小工具資料
GET /api/admin/dashboard/widgets/{widget_id}/data
Query: {
  refresh?: boolean;
  parameters?: string;                 // JSON格式的參數
}

// === 提醒系統API ===
// 取得提醒設定
GET /api/admin/dashboard/reminders/settings

// 更新提醒偏好
PUT /api/admin/dashboard/reminders/preferences
Body: {
  notification_channels: string[];
  working_hours: any;
  do_not_disturb_periods: any[];
  max_notifications_per_day: number;
}

// 標記提醒為已讀
POST /api/admin/dashboard/reminders/{reminder_id}/acknowledge

// 暫停特定類型提醒
POST /api/admin/dashboard/reminders/snooze
Body: {
  reminder_type: string;
  snooze_duration_minutes: number;
  reason?: string;
}

// === 快速操作API ===
// 執行快速操作
POST /api/admin/dashboard/quick-actions/{action_type}
Body: {
  target_id: number;
  parameters?: any;
  confirmation_code?: string;         // 對於敏感操作
}

// 取得可用的快速操作
GET /api/admin/dashboard/quick-actions
Query: {
  context?: string;                   // 上下文環境
  entity_type?: string;
  entity_id?: number;
}

// === 搜尋與篩選API ===
// 全域搜尋
GET /api/admin/dashboard/search
Query: {
  query: string;
  categories?: string[];              // tasks, approvals, orders, customers, products
  limit?: number;
  include_suggestions?: boolean;
}

// 儲存常用篩選
POST /api/admin/dashboard/saved-filters
Body: {
  filter_name: string;
  filter_config: any;
  is_public: boolean;
}

// 取得儲存的篩選
GET /api/admin/dashboard/saved-filters
Query: {
  include_public?: boolean;
}
```

## 資料庫設計

### 8. 核心資料表
```sql
-- 待辦事項表
CREATE TABLE dashboard_tasks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_type VARCHAR(50) NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    priority ENUM('critical', 'high', 'medium', 'low', 'info') DEFAULT 'medium',
    status ENUM('pending', 'in_progress', 'waiting_for_approval', 'approved', 'rejected', 'completed', 'cancelled', 'escalated') DEFAULT 'pending',
    
    -- 關聯資訊
    related_module VARCHAR(50) NOT NULL,
    related_entity_type VARCHAR(50) NOT NULL,
    related_entity_id BIGINT NOT NULL,
    
    -- 負責人資訊
    assigned_to BIGINT,
    assigned_by BIGINT,
    assigned_at TIMESTAMP NULL,
    
    -- 時間管理
    due_date TIMESTAMP NULL,
    estimated_duration_minutes INT,
    started_at TIMESTAMP NULL,
    completed_at TIMESTAMP NULL,
    
    -- 業務邏輯
    business_impact ENUM('revenue_critical', 'customer_critical', 'operational_critical', 'compliance_critical', 'moderate_impact', 'low_impact') DEFAULT 'moderate_impact',
    auto_escalation_hours INT,
    escalation_recipients JSON,
    
    -- 操作快捷
    quick_actions JSON,
    related_documents JSON,
    
    -- 追蹤資訊
    view_count INT DEFAULT 0,
    reminder_sent_at TIMESTAMP NULL,
    custom_fields JSON,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_assigned_status (assigned_to, status),
    INDEX idx_priority_due (priority, due_date),
    INDEX idx_type_status (task_type, status),
    INDEX idx_related_entity (related_module, related_entity_type, related_entity_id),
    INDEX idx_due_date (due_date),
    INDEX idx_created (created_at)
);

-- 簽核流程實例表
CREATE TABLE approval_instances (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    workflow_id BIGINT NOT NULL,
    entity_type VARCHAR(50) NOT NULL,
    entity_id BIGINT NOT NULL,
    
    -- 申請資訊
    submitted_by BIGINT NOT NULL,
    submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    submission_notes TEXT,
    
    -- 流程狀態
    current_step INT DEFAULT 1,
    overall_status ENUM('pending', 'in_progress', 'approved', 'rejected', 'cancelled') DEFAULT 'pending',
    
    -- 時間追蹤
    due_date TIMESTAMP NULL,
    completed_at TIMESTAMP NULL,
    total_processing_time_minutes INT,
    
    -- 附加資訊
    priority ENUM('critical', 'high', 'medium', 'low', 'info') DEFAULT 'medium',
    business_impact ENUM('revenue_critical', 'customer_critical', 'operational_critical', 'compliance_critical', 'moderate_impact', 'low_impact') DEFAULT 'moderate_impact',
    risk_level ENUM('low', 'medium', 'high'),
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_workflow_status (workflow_id, overall_status),
    INDEX idx_submitted_by (submitted_by, submitted_at),
    INDEX idx_entity (entity_type, entity_id),
    INDEX idx_current_step (current_step, overall_status),
    INDEX idx_due_date (due_date)
);

-- 簽核動作記錄表
CREATE TABLE approval_actions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    approval_instance_id BIGINT NOT NULL,
    step_number INT NOT NULL,
    
    -- 簽核者資訊
    approver_id BIGINT NOT NULL,
    approver_name VARCHAR(100) NOT NULL,
    approver_role VARCHAR(50),
    
    -- 簽核結果
    action ENUM('approve', 'reject', 'delegate', 'request_info', 'escalate') NOT NULL,
    decision_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    comments TEXT,
    attachments JSON,
    
    -- 委派資訊
    delegated_to BIGINT,
    delegation_reason TEXT,
    
    -- 系統資訊
    ip_address VARCHAR(45),
    user_agent TEXT,
    processing_time_minutes INT DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_approval_instance (approval_instance_id),
    INDEX idx_approver_date (approver_id, decision_date),
    INDEX idx_action_step (action, step_number)
);

-- 儀表板配置表
CREATE TABLE dashboard_configurations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    dashboard_name VARCHAR(100) NOT NULL,
    is_default BOOLEAN DEFAULT false,
    
    -- 佈局設定
    layout_config JSON NOT NULL,
    
    -- 小工具設定
    widgets JSON NOT NULL,
    
    -- 篩選設定
    global_filters JSON,
    
    -- 自動重整設定
    auto_refresh JSON,
    
    -- 通知設定
    notification_preferences JSON,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_user_dashboard (user_id, dashboard_name),
    INDEX idx_user_default (user_id, is_default)
);

-- 儀表板小工具表
CREATE TABLE dashboard_widgets (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    widget_id VARCHAR(50) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL,
    widget_type VARCHAR(50) NOT NULL,
    title VARCHAR(255) NOT NULL,
    
    -- 位置資訊
    position_config JSON NOT NULL,
    
    -- 資料源設定
    data_source VARCHAR(100) NOT NULL,
    data_parameters JSON,
    refresh_interval_seconds INT DEFAULT 300,
    
    -- 顯示設定
    display_options JSON,
    
    -- 互動設定
    click_actions JSON,
    
    -- 權限設定
    required_permissions JSON,
    
    is_visible BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_user_type (user_id, widget_type),
    INDEX idx_widget_id (widget_id),
    INDEX idx_visible (is_visible)
);

-- 任務生成規則表
CREATE TABLE task_generation_rules (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    rule_name VARCHAR(255) NOT NULL,
    module VARCHAR(50) NOT NULL,
    trigger_condition TEXT NOT NULL,
    
    -- 任務模板
    task_template JSON NOT NULL,
    
    -- 觸發設定
    trigger_type ENUM('event', 'schedule', 'threshold', 'manual') NOT NULL,
    trigger_frequency VARCHAR(50),
    trigger_parameters JSON,
    
    -- 分配規則
    assignment_rules JSON NOT NULL,
    
    -- 升級規則
    escalation_enabled BOOLEAN DEFAULT false,
    escalation_hours INT,
    escalation_chain JSON,
    
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_module_active (module, is_active),
    INDEX idx_trigger_type (trigger_type)
);

-- 營運指標快照表
CREATE TABLE operational_metrics_snapshots (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    snapshot_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- 即時指標
    real_time_metrics JSON NOT NULL,
    
    -- 效率指標
    efficiency_metrics JSON NOT NULL,
    
    -- 異常監控
    anomaly_data JSON NOT NULL,
    
    -- 系統健康
    system_health JSON NOT NULL,
    
    -- 計算時間
    calculation_time_ms INT,
    
    INDEX idx_snapshot_time (snapshot_time)
);

-- 提醒記錄表
CREATE TABLE reminder_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    reminder_rule_id BIGINT NOT NULL,
    target_entity_type VARCHAR(50) NOT NULL,
    target_entity_id BIGINT NOT NULL,
    
    -- 收件人資訊
    recipient_id BIGINT NOT NULL,
    recipient_email VARCHAR(255),
    recipient_phone VARCHAR(20),
    
    -- 提醒內容
    notification_channel VARCHAR(20) NOT NULL,
    subject VARCHAR(255),
    message TEXT,
    
    -- 發送狀態
    send_status ENUM('pending', 'sent', 'delivered', 'failed', 'bounced') DEFAULT 'pending',
    sent_at TIMESTAMP NULL,
    delivered_at TIMESTAMP NULL,
    
    -- 回應追蹤
    opened_at TIMESTAMP NULL,
    clicked_at TIMESTAMP NULL,
    action_taken_at TIMESTAMP NULL,
    
    -- 錯誤資訊
    error_message TEXT,
    retry_count INT DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_target_entity (target_entity_type, target_entity_id),
    INDEX idx_recipient_date (recipient_id, sent_at),
    INDEX idx_status_channel (send_status, notification_channel)
);
```

## 效能優化與整合

### 9. 系統整合設計
```typescript
// 與其他模組的整合接口
interface DashboardIntegration {
  // 庫存模組整合
  inventory_integration: {
    low_stock_threshold_sync: boolean;
    auto_generate_reorder_tasks: boolean;
    supplier_performance_alerts: boolean;
  };
  
  // 訂單模組整合
  order_integration: {
    high_risk_order_review: boolean;
    payment_confirmation_queue: boolean;
    shipping_delay_alerts: boolean;
    return_approval_workflow: boolean;
  };
  
  // 客服模組整合
  customer_service_integration: {
    priority_ticket_escalation: boolean;
    sla_breach_notifications: boolean;
    satisfaction_score_monitoring: boolean;
  };
  
  // 會計模組整合
  accounting_integration: {
    approval_workflow_sync: boolean;
    budget_variance_alerts: boolean;
    invoice_approval_queue: boolean;
  };
  
  // 通知模組整合
  notification_integration: {
    unified_notification_center: boolean;
    cross_module_alert_aggregation: boolean;
    intelligent_notification_routing: boolean;
  };
}

// 快取策略
interface CacheStrategy {
  task_list_cache: {
    cache_duration_seconds: 300;
    invalidation_triggers: string[];
    cache_key_pattern: string;
  };
  
  metrics_cache: {
    real_time_cache_seconds: 60;
    efficiency_cache_seconds: 900;
    historical_cache_hours: 24;
  };
  
  dashboard_config_cache: {
    user_config_cache_hours: 24;
    widget_data_cache_minutes: 5;
    global_config_cache_hours: 1;
  };
}
```

這個儀表板系統專注於營運管理的即時性和可操作性，通過智能任務生成、多層次簽核流程、實時指標監控和個人化設定，為管理者提供了一個高效的營運指揮中心。與數據分析模組相比，它更強調「現在需要做什麼」而非「過去發生了什麼」，真正實現了營運管理的數位化轉型。