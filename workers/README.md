# MickeyShop Beauty - Cloudflare Workers API

MickeyShop Beauty å¾Œç«¯ APIï¼Œä½¿ç”¨ Cloudflare Workers + D1 + Drizzle ORM æ§‹å»ºã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£…ä¾è³´
```bash
npm install
```

### 2. é…ç½®ç’°å¢ƒ
```bash
# å¤åˆ¶ç’°å¢ƒè®Šæ•¸æ¨¡æ¿
cp .env.example .env

# ç·¨è¼¯ wrangler.tomlï¼Œè¨­ç½®ä½ çš„ database_id
```

### 3. å‰µå»ºè³‡æ–™åº« Schema
```bash
# ç”Ÿæˆé·ç§»æ–‡ä»¶
npm run db:generate

# å‰µå»ºæœ¬åœ° D1 è³‡æ–™åº« (é–‹ç™¼ç’°å¢ƒ)
wrangler d1 create mickeyshop-beauty-dev

# åŸ·è¡Œé·ç§» (æœ¬åœ°)
wrangler d1 migrations apply mickeyshop-beauty-dev --local

# åŸ·è¡Œé·ç§» (é ç¨‹é–‹ç™¼ç’°å¢ƒ)
wrangler d1 migrations apply mickeyshop-beauty-dev
```

### 4. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
```bash
npm run dev
```

## ğŸ“ é …ç›®çµæ§‹

```
workers/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â””â”€â”€ database/           # è³‡æ–™åº«é…ç½®å’Œ Schema
â”‚   â”‚       â””â”€â”€ schema/         # Drizzle Schema å®šç¾©
â”‚   â”œâ”€â”€ controllers/            # æ§åˆ¶å™¨å±¤
â”‚   â”œâ”€â”€ services/               # æœå‹™å±¤ (æœªä¾†å¯¦ç¾)
â”‚   â”œâ”€â”€ middlewares/            # ä¸­é–“ä»¶
â”‚   â”œâ”€â”€ routes/                 # è·¯ç”±å®šç¾©
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ types/                  # TypeScript é¡å‹å®šç¾©
â”‚   â”œâ”€â”€ shared/                 # å…±ç”¨çµ„ä»¶
â”‚   â”‚   â””â”€â”€ services/           # åŸºç¤æœå‹™é¡
â”‚   â””â”€â”€ scripts/                # è…³æœ¬æ–‡ä»¶
â”œâ”€â”€ migrations/                 # è³‡æ–™åº«é·ç§»æ–‡ä»¶
â”œâ”€â”€ tests/                      # æ¸¬è©¦æ–‡ä»¶ (æœªä¾†å¯¦ç¾)
â”œâ”€â”€ drizzle.config.ts          # Drizzle é…ç½®
â”œâ”€â”€ wrangler.toml              # Cloudflare Workers é…ç½®
â””â”€â”€ package.json
```

## ğŸ›  é–‹ç™¼æŒ‡ä»¤

```bash
# é–‹ç™¼
npm run dev                    # å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
npm run typecheck             # TypeScript é¡å‹æª¢æŸ¥
npm run lint                  # ESLint æª¢æŸ¥
npm run test                  # é‹è¡Œæ¸¬è©¦

# è³‡æ–™åº«
npm run db:generate           # ç”Ÿæˆé·ç§»æ–‡ä»¶
npm run db:push              # æ¨é€ Schema è®Šæ›´
npm run db:migrate           # åŸ·è¡Œé·ç§»è…³æœ¬
npm run db:seed              # å‰µå»ºç¨®å­è³‡æ–™

# éƒ¨ç½²
npm run build                # æ§‹å»ºé …ç›®
npm run deploy               # éƒ¨ç½²åˆ° Cloudflare Workers
```

## ğŸŒ API ç«¯é»

### ç³»çµ± API (`/api/system/v1`)
- `GET /health` - å¥åº·æª¢æŸ¥
- `GET /info` - ç³»çµ±ä¿¡æ¯
- `GET /version` - ç‰ˆæœ¬ä¿¡æ¯

### å‰å° API (`/api/v1`)
- å•†å“ã€è¨‚å–®ã€ç”¨æˆ¶ç›¸é—œ API (æœªä¾†å¯¦ç¾)

### å¾Œå° API (`/api/admin/v1`)  
- ç®¡ç†å¾Œå°ç›¸é—œ API (æœªä¾†å¯¦ç¾)

## ğŸ“‹ å·²å¯¦ç¾åŠŸèƒ½

### âœ… Phase 1: å¾Œç«¯åŸºç¤æ¶æ§‹ (å·²å®Œæˆ)

1. **Cloudflare Workers åˆå§‹åŒ–**
   - âœ… å®Œæ•´çš„é …ç›®çµæ§‹
   - âœ… Hono.js è·¯ç”±æ¡†æ¶é…ç½®
   - âœ… TypeScript åš´æ ¼æ¨¡å¼é…ç½®
   - âœ… ç’°å¢ƒè®Šæ•¸ç®¡ç†

2. **è³‡æ–™åº«æ¶æ§‹å»ºç«‹**
   - âœ… D1 è³‡æ–™åº«é…ç½® (wrangler.toml)
   - âœ… å®Œæ•´çš„è³‡æ–™åº« Schema (Drizzle ORM)
   - âœ… è³‡æ–™åº«é·ç§»ç®¡ç†ç³»çµ±
   - âœ… çµ±ä¸€çš„è³‡æ–™åº«è¨­è¨ˆæ¨™æº–

3. **ä¸­é–“ä»¶èˆ‡å·¥å…·å±¤**
   - âœ… çµ±ä¸€éŒ¯èª¤è™•ç†ä¸­é–“ä»¶
   - âœ… CORS å’Œå®‰å…¨ä¸­é–“ä»¶
   - âœ… è«‹æ±‚é©—è­‰ä¸­é–“ä»¶ (åŸºæ–¼ Zod)
   - âœ… èªè­‰æˆæ¬Šä¸­é–“ä»¶
   - âœ… æ—¥èªŒç³»çµ±å’Œæ€§èƒ½ç›£æ§
   - âœ… è«‹æ±‚ ID è¿½è¹¤
   - âœ… é€Ÿç‡é™åˆ¶

4. **åŸºç¤æœå‹™å±¤**
   - âœ… BaseService å’Œ BaseController æŠ½è±¡é¡
   - âœ… çµ±ä¸€çš„ API éŸ¿æ‡‰æ ¼å¼
   - âœ… åˆ†é å’Œæœå°‹åŠŸèƒ½æ”¯æ´
   - âœ… æœå‹™éŸ¿æ‡‰è™•ç†

5. **å·¥å…·å‡½æ•¸å’Œé¡å‹å®šç¾©**
   - âœ… é€šç”¨å·¥å…·å‡½æ•¸ (IDç”Ÿæˆã€æ—¥æœŸè™•ç†ã€é©—è­‰ç­‰)
   - âœ… å®Œæ•´çš„ TypeScript é¡å‹å®šç¾©
   - âœ… é€šç”¨ä»‹é¢å’Œé¡å‹

## ğŸ“Š è³‡æ–™åº« Schema

å·²å»ºç«‹å®Œæ•´çš„è³‡æ–™åº«è¡¨çµæ§‹ï¼Œç¬¦åˆ `backend/23-è³‡æ–™åº«è¨­è¨ˆæ¨™æº–åŒ–.md` è¦ç¯„ï¼š

### æ¬Šé™ç®¡ç†ç³»çµ±
- `permissions` - æ¬Šé™è¡¨
- `roles` - è§’è‰²è¡¨  
- `role_permissions` - è§’è‰²æ¬Šé™é—œè¯
- `user_roles` - ç”¨æˆ¶è§’è‰²é—œè¯
- `user_permissions` - ç”¨æˆ¶ç›´æ¥æ¬Šé™
- `permission_change_logs` - æ¬Šé™è®Šæ›´æ—¥èªŒ

### ç®¡ç†å“¡ç®¡ç†ç³»çµ±
- `admin_users` - ç®¡ç†å“¡ç”¨æˆ¶
- `admin_sessions` - ç®¡ç†å“¡æœƒè©±
- `admin_activity_logs` - ç®¡ç†å“¡æ“ä½œæ—¥èªŒ
- `admin_security_events` - ç®¡ç†å“¡å®‰å…¨äº‹ä»¶

### å®¢æˆ¶ç®¡ç†ç³»çµ±
- `customers` - å®¢æˆ¶è¡¨
- `customer_addresses` - å®¢æˆ¶åœ°å€
- `customer_sessions` - å®¢æˆ¶æœƒè©±
- `customer_activity_logs` - å®¢æˆ¶æ´»å‹•æ—¥èªŒ
- `customer_wishlists` - å®¢æˆ¶é¡˜æœ›æ¸…å–®

### å•†å“ç®¡ç†ç³»çµ±
- `product_categories` - å•†å“åˆ†é¡
- `product_brands` - å•†å“å“ç‰Œ
- `products` - å•†å“ä¸»è¡¨
- `product_variations` - å•†å“è®ŠåŒ–ç‰ˆæœ¬
- `product_inventory_history` - åº«å­˜æ­·å²

### ç³»çµ±ç®¡ç†
- `system_settings` - ç³»çµ±è¨­å®š
- `system_tasks` - ç³»çµ±ä»»å‹™/ä½œæ¥­
- `system_notifications` - ç³»çµ±é€šçŸ¥
- `system_logs` - ç³»çµ±æ—¥èªŒ
- `system_cache` - ç³»çµ±å¿«å–
- `system_stats` - ç³»çµ±çµ±è¨ˆ

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- JWT Token èªè­‰ (ä½¿ç”¨ Cloudflare Workers å…¼å®¹åº«)
- åŸºæ–¼è§’è‰²å’Œæ¬Šé™çš„è¨ªå•æ§åˆ¶ (RBAC)
- è«‹æ±‚é€Ÿç‡é™åˆ¶
- CORS å®‰å…¨é…ç½®
- è«‹æ±‚åƒæ•¸é©—è­‰ (Zod Schema)
- SQL æ³¨å…¥é˜²è­· (Drizzle ORM)
- å®‰å…¨æ¨™é ­è¨­ç½®

## ğŸš§ ä¸‹ä¸€æ­¥è¨ˆåŠƒ

### Phase 2: æ ¸å¿ƒæ¥­å‹™æ¨¡çµ„ (è¨ˆåŠƒä¸­)
1. ç®¡ç†å“¡ç®¡ç†ç³»çµ±å®Œæ•´å¯¦ç¾
2. å•†å“ç®¡ç†ç³»çµ± (CRUD + åº«å­˜ç®¡ç†)
3. å®¢æˆ¶ç®¡ç†ç³»çµ±
4. åŸºç¤è¨‚å–®ç®¡ç†åŠŸèƒ½

### Phase 3: é€²éšåŠŸèƒ½ (è¨ˆåŠƒä¸­)
1. æ”¯ä»˜ç³»çµ±æ•´åˆ (ç¶ ç•Œç§‘æŠ€)
2. ç‰©æµç³»çµ±æ•´åˆ
3. é€šçŸ¥ç³»çµ±
4. åˆ†æå’Œå ±è¡¨åŠŸèƒ½

## ğŸ“– é–‹ç™¼è¦ç¯„

é …ç›®åš´æ ¼éµå¾ªä»¥ä¸‹è¨­è¨ˆè¦ç¯„ï¼š
- `backend/23-è³‡æ–™åº«è¨­è¨ˆæ¨™æº–åŒ–.md` - è³‡æ–™åº«è¨­è¨ˆæ¨™æº–
- `backend/24-APIä»‹é¢è¦ç¯„çµ±ä¸€.md` - API ä»‹é¢è¦ç¯„  
- `backend/25-æ¬Šé™ç®¡ç†é«”ç³»çµ±ä¸€.md` - æ¬Šé™ç®¡ç†é«”ç³»
- `.claude/CLAUDE.md` - é–‹ç™¼æµç¨‹è¦ç¯„

## ğŸ¤ è²¢ç»æŒ‡å—

1. éµå¾ªç¾æœ‰çš„ä»£ç¢¼é¢¨æ ¼å’Œæ¶æ§‹
2. ç¢ºä¿ TypeScript åš´æ ¼æ¨¡å¼é€šé
3. æ–°å¢åŠŸèƒ½éœ€åŒ…å«é©ç•¶çš„éŒ¯èª¤è™•ç†
4. éµå¾ªçµ±ä¸€çš„ API éŸ¿æ‡‰æ ¼å¼
5. æ›´æ–°ç›¸é—œæ–‡æª”

## ğŸ“„ æˆæ¬Š

MIT License