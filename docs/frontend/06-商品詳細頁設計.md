# 商品詳細頁設計

## 系統概覽

商品詳細頁是電商網站的核心轉換頁面，展示完整商品信息、變體選擇、用戶評價、相關推薦等功能，與快速加購系統、購物車系統深度整合。

## 頁面架構設計

### 1. 整體布局結構
```jsx
// pages/ProductDetail/index.jsx
const ProductDetailPage = () => {
  const { productId } = useParams()
  const { locale } = useI18nStore()
  const { product, loading } = useProductQuery(productId)
  
  if (loading) return <ProductDetailSkeleton />
  if (!product) return <ProductNotFound />
  
  return (
    <div className={styles.productDetailPage}>
      {/* SEO Head */}
      <ProductSEOHead product={product} />
      
      {/* 商品資訊區塊 */}
      <section className={styles.productInfo}>
        <ProductGallery product={product} />
        <ProductBasicInfo product={product} />
      </section>
      
      {/* 商品描述區塊 */}
      <section className={styles.productDescription}>
        <ProductDescription product={product} />
      </section>
      
      {/* 評價系統 */}
      <section className={styles.reviewSection}>
        <ProductReviews product={product} />
      </section>
      
      {/* 相關推薦 */}
      <section className={styles.recommendations}>
        <RelatedProducts product={product} />
      </section>
    </div>
  )
}
```

### 2. 響應式布局策略
```scss
// styles/ProductDetail.module.scss
.productDetailPage {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  
  .productInfo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-bottom: 60px;
    
    @media (max-width: 768px) {
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
  }
  
  .productDescription,
  .reviewSection,
  .recommendations {
    margin-bottom: 40px;
    
    @media (max-width: 768px) {
      margin-bottom: 20px;
    }
  }
}
```

## 商品圖片展示系統

### 1. 圖片畫廊組件（含縮圖導航）
```jsx
// components/ProductGallery/index.jsx
import { useState, useRef } from 'react'
import { Swiper, SwiperSlide } from 'swiper/react'
import { Navigation, Pagination, Thumbs, Zoom } from 'swiper/modules'
import { Modal, Button } from 'antd'
import { ExpandOutlined, LeftOutlined, RightOutlined } from '@ant-design/icons'

const ProductGallery = ({ product }) => {
  const [thumbsSwiper, setThumbsSwiper] = useState(null)
  const [activeIndex, setActiveIndex] = useState(0)
  const [lightboxVisible, setLightboxVisible] = useState(false)
  const mainSwiperRef = useRef(null)
  
  // 缺貨檢查 - 如果所有變體都缺貨，商品大圖要反白顯示缺貨字樣
  const isAllOutOfStock = product.skus?.every(sku => sku.stock === 0) || false
  
  const handleImageClick = (index) => {
    setActiveIndex(index)
    setLightboxVisible(true)
  }
  
  return (
    <div className={styles.productGallery}>
      {/* 主圖片輪播 */}
      <div className={styles.mainGallery}>
        <Swiper
          ref={mainSwiperRef}
          modules={[Navigation, Pagination, Thumbs, Zoom]}
          thumbs={{ swiper: thumbsSwiper }}
          navigation={{
            prevEl: '.custom-prev',
            nextEl: '.custom-next',
          }}
          pagination={{
            clickable: true,
            dynamicBullets: true,
          }}
          zoom={{
            maxRatio: 3,
            minRatio: 1,
          }}
          onSlideChange={(swiper) => setActiveIndex(swiper.activeIndex)}
          className={styles.mainSwiper}
        >
          {product.images.map((image, index) => (
            <SwiperSlide key={index}>
              <div className={`${styles.imageContainer} ${isAllOutOfStock ? styles.outOfStock : ''}`}>
                <div className="swiper-zoom-container">
                  <img
                    src={image.url}
                    alt={`${product.name} - ${index + 1}`}
                    className={styles.productImage}
                    onClick={() => handleImageClick(index)}
                  />
                </div>
                
                {/* 缺貨遮罩 */}
                {isAllOutOfStock && (
                  <div className={styles.outOfStockOverlay}>
                    <span className={styles.outOfStockText}>暫無庫存</span>
                  </div>
                )}
                
                {/* 放大按鈕 */}
                <Button
                  className={styles.expandBtn}
                  icon={<ExpandOutlined />}
                  onClick={() => handleImageClick(index)}
                />
              </div>
            </SwiperSlide>
          ))}
          
          {/* 自定義導航按鈕 */}
          <div className="custom-prev">
            <LeftOutlined />
          </div>
          <div className="custom-next">
            <RightOutlined />
          </div>
        </Swiper>
      </div>
      
      {/* 縮圖導航 */}
      <div className={styles.thumbsGallery}>
        <Swiper
          onSwiper={setThumbsSwiper}
          spaceBetween={10}
          slidesPerView={5}
          watchSlidesProgress
          className={styles.thumbsSwiper}
          breakpoints={{
            320: { slidesPerView: 3 },
            480: { slidesPerView: 4 },
            768: { slidesPerView: 5 },
          }}
        >
          {product.images.map((image, index) => (
            <SwiperSlide key={index}>
              <img
                src={image.thumbnail || image.url}
                alt={`${product.name} - 縮圖 ${index + 1}`}
                className={`${styles.thumbImage} ${
                  activeIndex === index ? styles.active : ''
                }`}
              />
            </SwiperSlide>
          ))}
        </Swiper>
      </div>
      
      {/* 燈箱功能 */}
      <Modal
        open={lightboxVisible}
        onCancel={() => setLightboxVisible(false)}
        footer={null}
        width="90vw"
        style={{ top: 20 }}
        className={styles.lightboxModal}
      >
        <LightboxGallery
          images={product.images}
          activeIndex={activeIndex}
          onIndexChange={setActiveIndex}
        />
      </Modal>
    </div>
  )
}
```

### 2. 燈箱畫廊組件
```jsx
// components/LightboxGallery/index.jsx
const LightboxGallery = ({ images, activeIndex, onIndexChange }) => {
  return (
    <div className={styles.lightboxGallery}>
      <Swiper
        initialSlide={activeIndex}
        navigation
        pagination
        zoom={{ maxRatio: 5 }}
        onSlideChange={(swiper) => onIndexChange(swiper.activeIndex)}
        className={styles.lightboxSwiper}
      >
        {images.map((image, index) => (
          <SwiperSlide key={index}>
            <div className="swiper-zoom-container">
              <img
                src={image.url}
                alt={`放大檢視 - ${index + 1}`}
                className={styles.lightboxImage}
              />
            </div>
          </SwiperSlide>
        ))}
      </Swiper>
      
      {/* 圖片計數器 */}
      <div className={styles.imageCounter}>
        {activeIndex + 1} / {images.length}
      </div>
    </div>
  )
}
```

## 商品基本信息展示

### 1. 商品信息組件
```jsx
// components/ProductBasicInfo/index.jsx
const ProductBasicInfo = ({ product }) => {
  const { user } = useAuthStore()
  const { currency, formatPrice } = useI18nStore()
  const [selectedVariants, setSelectedVariants] = useState({})
  const [quantity, setQuantity] = useState(1)
  const [currentSku, setCurrentSku] = useState(null)
  const [stockStatus, setStockStatus] = useState('checking')
  
  return (
    <div className={styles.productBasicInfo}>
      {/* 品牌標誌 */}
      {product.brand && (
        <div className={styles.brandInfo}>
          <img 
            src={product.brand.logo} 
            alt={product.brand.name}
            className={styles.brandLogo}
          />
          <span className={styles.brandName}>{product.brand.name}</span>
        </div>
      )}
      
      {/* 商品標題 */}
      <h1 className={styles.productTitle}>{product.name}</h1>
      
      {/* 商品編號/SKU */}
      <div className={styles.productSku}>
        <span className={styles.skuLabel}>商品編號：</span>
        <span className={styles.skuValue}>
          {currentSku?.sku || product.baseSkuPrefix}
        </span>
      </div>
      
      {/* 評分和評論數量，並且要顯示置頂評論 */}
      <div className={styles.ratingInfo}>
        <Rate disabled defaultValue={product.rating} allowHalf />
        <span className={styles.ratingValue}>({product.rating})</span>
        <span className={styles.reviewCount}>
          {product.reviewCount} 則評價
        </span>
        
        {/* 快速新增評論按鈕 */}
        <Button 
          type="link" 
          size="small"
          onClick={() => openQuickReviewModal()}
          className={styles.quickReviewBtn}
        >
          快速評價
        </Button>
        
        {/* 查看所有評論按鈕 */}
        <Button 
          type="link" 
          size="small"
          onClick={() => openAllReviewsModal()}
          className={styles.allReviewsBtn}
        >
          查看所有評價
        </Button>
        
        {/* 商品標籤（如"熱銷"、"新品"） */}
        {product.badges?.length > 0 && (
          <div className={styles.badges}>
            {product.badges.map(badge => (
              <Tag key={badge.id} color={badge.color}>
                {badge.text}
              </Tag>
            ))}
          </div>
        )}
      </div>
      
      {/* 置頂評論顯示 */}
      {product.pinnedReview && (
        <div className={styles.pinnedReview}>
          <div className={styles.pinnedReviewHeader}>
            <PushpinOutlined className={styles.pinIcon} />
            <span>置頂評價</span>
          </div>
          <div className={styles.pinnedReviewContent}>
            <Rate disabled defaultValue={product.pinnedReview.rating} size="small" />
            <p>{product.pinnedReview.content}</p>
            <span className={styles.reviewAuthor}>- {product.pinnedReview.userName}</span>
          </div>
        </div>
      )}
      
      {/* 價格區域 - 支援節慶價格 */}
      <PriceSection
        product={product}
        selectedVariants={selectedVariants}
        currentSku={currentSku}
        user={user}
        currency={currency}
      />
      
      {/* 商品變體選擇 */}
      <VariantSelectionArea
        product={product}
        selectedVariants={selectedVariants}
        onVariantChange={setSelectedVariants}
        onSkuChange={setCurrentSku}
        onStockChange={setStockStatus}
      />
      
      {/* 數量選擇和操作按鈕 */}
      <ActionArea
        product={product}
        selectedVariants={selectedVariants}
        quantity={quantity}
        onQuantityChange={setQuantity}
        stockStatus={stockStatus}
        currentSku={currentSku}
      />
      
      {/* 收藏/心願清單功能 */}
      <WishlistButton product={product} />
      
      {/* 分享到社交媒體的功能 */}
      <SocialShare product={product} />
    </div>
  )
}
```

### 2. 價格展示組件（支援節慶價格）
```jsx
// components/PriceSection/index.jsx
const PriceSection = ({ product, selectedVariants, currentSku, user, currency }) => {
  const calculateCurrentPrice = () => {
    let basePrice = currentSku?.price || product.basePrice
    
    // 節慶價格優先級最高
    if (product.festivalPrices?.length > 0) {
      const activeFestival = product.festivalPrices.find(fp => 
        fp.isActive && new Date() >= fp.startDate && new Date() <= fp.endDate
      )
      if (activeFestival) {
        return activeFestival.price
      }
    }
    
    // 會員價格其次
    if (user?.memberTier) {
      const memberDiscount = getMemberDiscount(user.memberTier)
      basePrice *= (1 - memberDiscount)
      return basePrice
    }
    
    // 最後使用優惠價
    return currentSku?.salePrice || product.salePrice || basePrice
  }
  
  const currentPrice = calculateCurrentPrice()
  const originalPrice = currentSku?.originalPrice || product.originalPrice
  const hasDiscount = originalPrice && originalPrice > currentPrice
  
  return (
    <div className={styles.priceSection}>
      <div className={styles.currentPrice}>
        <span className={styles.currency}>{getCurrencySymbol(currency)}</span>
        <span className={styles.price}>{formatPrice(currentPrice)}</span>
        
        {/* 價格標籤 */}
        {product.festivalPrices?.some(fp => fp.isActive) && (
          <Tag color="red" className={styles.priceTag}>節慶價</Tag>
        )}
        {user?.memberTier && !product.festivalPrices?.some(fp => fp.isActive) && (
          <Tag color="gold" className={styles.priceTag}>
            {user.memberTier.toUpperCase()} 會員價
          </Tag>
        )}
      </div>
      
      {hasDiscount && (
        <div className={styles.originalPrice}>
          <span className={styles.strikethrough}>
            {getCurrencySymbol(currency)}{formatPrice(originalPrice)}
          </span>
          <span className={styles.discount}>
            省 {getCurrencySymbol(currency)}{formatPrice(originalPrice - currentPrice)}
          </span>
        </div>
      )}
      
      {/* 價格區間顯示（多變體商品） */}
      {product.priceRange && (
        <div className={styles.priceRange}>
          {getCurrencySymbol(currency)}{formatPrice(product.priceRange.min)} - 
          {getCurrencySymbol(currency)}{formatPrice(product.priceRange.max)}
        </div>
      )}
    </div>
  )
}
```

### 3. 變體選擇區域
```jsx
// components/VariantSelectionArea/index.jsx
const VariantSelectionArea = ({ product, selectedVariants, onVariantChange, onSkuChange, onStockChange }) => {
  const [availableOptions, setAvailableOptions] = useState({})
  
  // 根據已選變體更新可用選項
  const updateAvailableOptions = useCallback((currentSelections) => {
    const available = {}
    
    product.variants.forEach(variant => {
      available[variant.name] = variant.options.filter(option => {
        // 檢查此選項與當前選擇是否有可用的 SKU
        const testSelections = { ...currentSelections, [variant.name]: option.value }
        return product.skus.some(sku => 
          sku.stock > 0 && 
          Object.entries(testSelections).every(([key, value]) => 
            sku.variants[key] === value
          )
        )
      })
    })
    
    setAvailableOptions(available)
  }, [product])
  
  const handleVariantSelect = (variantName, value) => {
    const newSelections = { ...selectedVariants, [variantName]: value }
    onVariantChange(newSelections)
    
    // 尋找匹配的 SKU
    const matchingSku = product.skus.find(sku =>
      Object.entries(newSelections).every(([key, val]) => sku.variants[key] === val)
    )
    
    if (matchingSku) {
      onSkuChange(matchingSku)
      
      // 庫存狀態檢查 - 前台不顯示庫存數量，只在缺貨時反白
      if (matchingSku.stock === 0) {
        // 檢查是否支援預購
        if (matchingSku.preOrderEnabled) {
          onStockChange({
            status: 'pre_order',
            available: 0,
            estimatedArrivalDays: matchingSku.estimatedArrivalDays
          })
        } else {
          onStockChange({
            status: 'out_of_stock',
            available: 0
          })
        }
      } else {
        onStockChange({
          status: 'available',
          available: matchingSku.stock
        })
      }
    }
    
    updateAvailableOptions(newSelections)
  }
  
  return (
    <div className={styles.variantSelectionArea}>
      {product.variants.map(variant => (
        <div key={variant.name} className={styles.variantGroup}>
          <div className={styles.variantHeader}>
            <span className={styles.variantLabel}>{variant.displayName}：</span>
            {selectedVariants[variant.name] && (
              <span className={styles.selectedValue}>
                {variant.options.find(opt => opt.value === selectedVariants[variant.name])?.displayName}
              </span>
            )}
          </div>
          
          <VariantOptionRenderer
            variant={variant}
            selectedValue={selectedVariants[variant.name]}
            availableOptions={availableOptions[variant.name] || []}
            onSelect={(value) => handleVariantSelect(variant.name, value)}
          />
        </div>
      ))}
    </div>
  )
}
```

### 4. 變體選項渲染器（可在後台設定顯示類型）
```jsx
// components/VariantOptionRenderer/index.jsx
const VariantOptionRenderer = ({ variant, selectedValue, availableOptions, onSelect }) => {
  // 根據後台設定的變體顯示類型來渲染
  if (variant.displayType === 'color') {
    return (
      <div className={styles.colorVariants}>
        {variant.options.map(option => {
          const isAvailable = availableOptions.includes(option)
          const isSelected = selectedValue === option.value
          const sku = option.sku // 獲取該選項對應的 SKU
          
          return (
            <Tooltip
              key={option.value}
              title={`${option.displayName}${!isAvailable ? 
                (sku?.preOrderEnabled ? ` (預購 - 約${sku.estimatedArrivalDays}天到貨)` : ' (無庫存)') 
                : ''}`}
            >
              <div
                className={`${styles.colorOption} 
                  ${isSelected ? styles.selected : ''} 
                  ${!isAvailable ? (sku?.preOrderEnabled ? styles.preOrder : styles.disabled) : ''}`}
                style={{ backgroundColor: option.colorCode }}
                onClick={() => isAvailable && onSelect(option.value)}
              >
                {isSelected && <CheckOutlined className={styles.checkIcon} />}
                {/* 預購標示 */}
                {!isAvailable && sku?.preOrderEnabled && (
                  <span className={styles.preOrderLabel}>預購</span>
                )}
              </div>
            </Tooltip>
          )
        })}
      </div>
    )
  }
  
  // 按鈕樣式（預設）
  return (
    <div className={styles.buttonVariants}>
      {variant.options.map(option => {
        const isAvailable = availableOptions.includes(option)
        const isSelected = selectedValue === option.value
        const sku = option.sku
        
        return (
          <Button
            key={option.value}
            type={isSelected ? 'primary' : 'default'}
            disabled={!isAvailable && !sku?.preOrderEnabled}
            onClick={() => onSelect(option.value)}
            className={`${styles.variantButton} ${
              !isAvailable && sku?.preOrderEnabled ? styles.preOrderButton : ''
            }`}
          >
            {option.displayName}
            {!isAvailable && (
              sku?.preOrderEnabled 
                ? ` (預購 - 約${sku.estimatedArrivalDays}天)` 
                : ' (缺貨)'
            )}
          </Button>
        )
      })}
    </div>
  )
}
```

## 操作區域設計

### 1. 加購操作組件
```jsx
// components/ActionArea/index.jsx
const ActionArea = ({ product, selectedVariants, quantity, onQuantityChange, stockStatus, currentSku }) => {
  const [isLoading, setIsLoading] = useState(false)
  const { addToCart, toggleCart } = useCartStore()
  const { user } = useAuthStore()
  
  const isAllVariantsSelected = product.variants.every(
    variant => selectedVariants[variant.name]
  )
  
  const canAddToCart = isAllVariantsSelected && 
                       (stockStatus.status === 'available' || stockStatus.status === 'pre_order')
  
  const handleAddToCart = async () => {
    if (!canAddToCart) return
    
    setIsLoading(true)
    try {
      await addToCart({
        productId: product.id,
        name: product.name,
        image: product.images[0].url,
        price: currentSku?.price || product.basePrice,
        quantity,
        variants: selectedVariants,
        sku: currentSku?.sku,
        isPreOrder: stockStatus.status === 'pre_order'
      })
      
      notification.success({
        message: stockStatus.status === 'pre_order' ? '已加入預購清單' : '已加入購物車',
        description: `${product.name} 已成功${stockStatus.status === 'pre_order' ? '加入預購清單' : '加入購物車'}`,
        duration: 2,
        placement: 'topRight'
      })
      
    } catch (error) {
      notification.error({
        message: '操作失敗',
        description: error.message,
        duration: 3
      })
    } finally {
      setIsLoading(false)
    }
  }
  
  const handleBuyNow = async () => {
    if (!canAddToCart) return
    
    await handleAddToCart()
    // 直接跳轉到結帳頁面
    window.location.href = '/checkout'
  }
  
  return (
    <div className={styles.actionArea}>
      {/* 數量選擇器 - 前台不顯示庫存數量 */}
      <div className={styles.quantitySelector}>
        <span className={styles.quantityLabel}>數量：</span>
        <InputNumber
          min={1}
          max={stockStatus.status === 'pre_order' ? 999 : (stockStatus.available || 999)}
          value={quantity}
          onChange={onQuantityChange}
          className={styles.quantityInput}
        />
      </div>
      
      {/* 購買按鈕組 */}
      <div className={styles.actionButtons}>
        {/* 加入購物車 / 預購 */}
        <Button
          type="primary"
          size="large"
          loading={isLoading}
          disabled={!canAddToCart}
          onClick={handleAddToCart}
          className={styles.addToCartBtn}
        >
          <ShoppingCartOutlined />
          {stockStatus.status === 'out_of_stock' 
            ? '暫無庫存' 
            : stockStatus.status === 'pre_order'
            ? `預購商品 (約${stockStatus.estimatedArrivalDays}天到貨)`
            : '加入購物車'
          }
        </Button>
        
        {/* 立即購買 */}
        <Button
          type="primary"
          size="large"
          disabled={!canAddToCart}
          onClick={handleBuyNow}
          className={styles.buyNowBtn}
          style={{ background: '#ff6b35' }}
        >
          立即購買
        </Button>
      </div>
      
      {/* 變體選擇提示 */}
      {!isAllVariantsSelected && (
        <div className={styles.selectionHint}>
          <InfoCircleOutlined />
          <span>請選擇 {
            product.variants
              .filter(variant => !selectedVariants[variant.name])
              .map(variant => variant.displayName)
              .join('、')
          }</span>
        </div>
      )}
      
      {/* 贈品信息 */}
      {product.gifts && product.gifts.length > 0 && (
        <div className={styles.giftInfo}>
          <GiftOutlined />
          <span>購買即贈：{product.gifts.map(gift => gift.name).join('、')}</span>
        </div>
      )}
    </div>
  )
}
```

## 商品描述區域

### 1. 商品描述組件（支援 Markdown）
```jsx
// components/ProductDescription/index.jsx
import ReactMarkdown from 'react-markdown'

const ProductDescription = ({ product }) => {
  return (
    <div className={styles.productDescription}>
      <h3 className={styles.sectionTitle}>商品詳情</h3>
      
      {/* Markdown 格式的商品描述 */}
      {product.description && (
        <div className={styles.markdownContent}>
          <ReactMarkdown
            components={{
              // 自定義 Markdown 組件樣式
              h1: ({ children }) => <h1 className={styles.mdH1}>{children}</h1>,
              h2: ({ children }) => <h2 className={styles.mdH2}>{children}</h2>,
              p: ({ children }) => <p className={styles.mdP}>{children}</p>,
              ul: ({ children }) => <ul className={styles.mdUl}>{children}</ul>,
              li: ({ children }) => <li className={styles.mdLi}>{children}</li>,
            }}
          >
            {product.description}
          </ReactMarkdown>
        </div>
      )}
      
      {/* 詳細圖片 */}
      {product.detailImages && product.detailImages.length > 0 && (
        <div className={styles.detailImages}>
          {product.detailImages.map((image, index) => (
            <img 
              key={index}
              src={image.url}
              alt={image.alt || `商品詳情 ${index + 1}`}
              className={styles.detailImage}
              loading="lazy"
            />
          ))}
        </div>
      )}
      
      {/* 影片介紹 */}
      {product.videoUrl && (
        <div className={styles.productVideo}>
          <video
            controls
            poster={product.videoPoster}
            className={styles.video}
          >
            <source src={product.videoUrl} type="video/mp4" />
            您的瀏覽器不支援影片播放。
          </video>
        </div>
      )}
    </div>
  )
}
```

## 評價系統設計

### 1. 評價列表組件
```jsx
// components/ProductReviews/index.jsx
const ProductReviews = ({ product }) => {
  const [reviews, setReviews] = useState([])
  const [loading, setLoading] = useState(true)
  const [sortBy, setSortBy] = useState('newest')
  const [filterRating, setFilterRating] = useState('all')
  const [currentPage, setCurrentPage] = useState(1)
  const [allReviewsModalVisible, setAllReviewsModalVisible] = useState(false)
  const [quickReviewModalVisible, setQuickReviewModalVisible] = useState(false)
  
  const reviewStats = {
    averageRating: product.rating,
    totalReviews: product.reviewCount,
    ratingDistribution: product.ratingDistribution
  }
  
  return (
    <div className={styles.productReviews}>
      <div className={styles.reviewsHeader}>
        <h3 className={styles.sectionTitle}>用戶評價</h3>
        
        {/* 彈出小頁面查看所有的評論按鈕 */}
        <Button 
          type="primary"
          onClick={() => setAllReviewsModalVisible(true)}
          className={styles.viewAllBtn}
        >
          查看所有評價 ({reviewStats.totalReviews})
        </Button>
        
        {/* 快速新增評論按鈕 */}
        <Button 
          onClick={() => setQuickReviewModalVisible(true)}
          className={styles.quickReviewBtn}
        >
          寫評價
        </Button>
      </div>
      
      {/* 評價統計 */}
      <div className={styles.reviewStats}>
        <div className={styles.averageRating}>
          <span className={styles.ratingValue}>{reviewStats.averageRating}</span>
          <Rate disabled defaultValue={reviewStats.averageRating} allowHalf />
          <span className={styles.totalReviews}>
            基於 {reviewStats.totalReviews} 則評價
          </span>
        </div>
        
        {/* 評分分布 */}
        <div className={styles.ratingDistribution}>
          {[5, 4, 3, 2, 1].map(rating => (
            <div key={rating} className={styles.ratingBar}>
              <span className={styles.ratingLabel}>{rating} 星</span>
              <Progress
                percent={(reviewStats.ratingDistribution[rating] / reviewStats.totalReviews) * 100}
                showInfo={false}
                strokeColor="var(--color-primary)"
              />
              <span className={styles.ratingCount}>
                {reviewStats.ratingDistribution[rating]}
              </span>
            </div>
          ))}
        </div>
      </div>
      
      {/* 前幾則評價預覽 */}
      <div className={styles.reviewPreview}>
        {reviews.slice(0, 3).map(review => (
          <ReviewItem key={review.id} review={review} />
        ))}
      </div>
      
      {/* 查看所有評論的彈窗 */}
      <Modal
        title="所有評價"
        open={allReviewsModalVisible}
        onCancel={() => setAllReviewsModalVisible(false)}
        footer={null}
        width={800}
        className={styles.allReviewsModal}
      >
        <AllReviewsModal
          product={product}
          onClose={() => setAllReviewsModalVisible(false)}
        />
      </Modal>
      
      {/* 快速評價彈窗 */}
      <Modal
        title="撰寫評價"
        open={quickReviewModalVisible}
        onCancel={() => setQuickReviewModalVisible(false)}
        footer={null}
        width={600}
        className={styles.quickReviewModal}
      >
        <QuickReviewModal
          product={product}
          onClose={() => setQuickReviewModalVisible(false)}
          onSuccess={() => {
            setQuickReviewModalVisible(false)
            // 重新載入評價
            loadReviews()
          }}
        />
      </Modal>
    </div>
  )
}
```

### 2. 快速評價彈窗
```jsx
// components/QuickReviewModal/index.jsx
const QuickReviewModal = ({ product, onClose, onSuccess }) => {
  const [form] = Form.useForm()
  const [rating, setRating] = useState(0)
  const [content, setContent] = useState('')
  const [images, setImages] = useState([])
  const [isSubmitting, setIsSubmitting] = useState(false)
  
  const handleSubmit = async () => {
    try {
      setIsSubmitting(true)
      
      const reviewData = {
        productId: product.id,
        rating: rating || 0, // 評分不是必填
        content: content || '', // 評價文字內容不是必填
        images: images // 最多可以上傳3張圖片，無格式和大小限制
      }
      
      await api.createReview(reviewData)
      
      notification.success({
        message: '評價提交成功',
        description: '感謝您的評價！',
        duration: 2
      })
      
      onSuccess()
      
    } catch (error) {
      notification.error({
        message: '提交失敗',
        description: error.message
      })
    } finally {
      setIsSubmitting(false)
    }
  }
  
  return (
    <div className={styles.quickReviewModal}>
      <Form form={form} layout="vertical">
        {/* 評分 */}
        <Form.Item label="評分（選填）">
          <Rate value={rating} onChange={setRating} />
        </Form.Item>
        
        {/* 評價內容 */}
        <Form.Item label="評價內容（選填）">
          <TextArea
            value={content}
            onChange={(e) => setContent(e.target.value)}
            placeholder="分享您的使用心得..."
            rows={4}
            showCount={false} // 不需要字數限制
          />
        </Form.Item>
        
        {/* 圖片上傳 */}
        <Form.Item label="評價圖片（選填，最多3張）">
          <Upload
            listType="picture-card"
            fileList={images}
            onChange={({ fileList }) => setImages(fileList)}
            beforeUpload={() => false} // 阻止自動上傳
            maxCount={3}
            accept="*" // 無格式限制
          >
            {images.length < 3 && (
              <div>
                <PlusOutlined />
                <div style={{ marginTop: 8 }}>上傳圖片</div>
              </div>
            )}
          </Upload>
        </Form.Item>
        
        {/* 提交按鈕 */}
        <Form.Item>
          <Space>
            <Button onClick={onClose}>取消</Button>
            <Button 
              type="primary" 
              loading={isSubmitting}
              onClick={handleSubmit}
            >
              提交評價
            </Button>
          </Space>
        </Form.Item>
      </Form>
    </div>
  )
}
```

## 社交分享功能

### 1. 社交分享組件
```jsx
// components/SocialShare/index.jsx
const SocialShare = ({ product }) => {
  const shareUrl = window.location.href
  const shareTitle = `${product.name} - MickeyShop Beauty`
  const shareDescription = product.shortDescription || product.name
  const shareImage = product.images[0]?.url
  
  const shareToFacebook = () => {
    const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`
    window.open(url, '_blank', 'width=600,height=400')
  }
  
  const shareToLine = () => {
    const url = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(shareUrl)}`
    window.open(url, '_blank', 'width=600,height=400')
  }
  
  const shareToTwitter = () => {
    const text = `${shareTitle} ${shareUrl}`
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`
    window.open(url, '_blank', 'width=600,height=400')
  }
  
  const copyToClipboard = async () => {
    try {
      await navigator.clipboard.writeText(shareUrl)
      notification.success({
        message: '連結已複製',
        duration: 2
      })
    } catch (error) {
      notification.error({
        message: '複製失敗',
        duration: 2
      })
    }
  }
  
  return (
    <div className={styles.socialShare}>
      <span className={styles.shareLabel}>分享商品：</span>
      <Space>
        <Button 
          icon={<FacebookOutlined />} 
          onClick={shareToFacebook}
          className={styles.shareBtn}
        >
          Facebook
        </Button>
        <Button 
          icon={<LineOutlined />} 
          onClick={shareToLine}
          className={styles.shareBtn}
        >
          LINE
        </Button>
        <Button 
          icon={<TwitterOutlined />} 
          onClick={shareToTwitter}
          className={styles.shareBtn}
        >
          Twitter
        </Button>
        <Button 
          icon={<LinkOutlined />} 
          onClick={copyToClipboard}
          className={styles.shareBtn}
        >
          複製連結
        </Button>
      </Space>
    </div>
  )
}
```

## 收藏清單功能

### 1. 收藏按鈕組件
```jsx
// components/WishlistButton/index.jsx
const WishlistButton = ({ product }) => {
  const { user } = useAuthStore()
  const [isWishlisted, setIsWishlisted] = useState(false)
  const [loading, setLoading] = useState(false)
  
  useEffect(() => {
    if (user) {
      checkWishlistStatus()
    }
  }, [user, product.id])
  
  const checkWishlistStatus = async () => {
    try {
      const response = await api.checkWishlist(product.id)
      setIsWishlisted(response.isWishlisted)
    } catch (error) {
      console.error('檢查收藏狀態失敗:', error)
    }
  }
  
  const handleWishlist = async () => {
    if (!user) {
      notification.warning({
        message: '請先登入',
        description: '登入後即可使用收藏功能'
      })
      return
    }
    
    setLoading(true)
    try {
      if (isWishlisted) {
        await api.removeFromWishlist(product.id)
        setIsWishlisted(false)
        notification.success({
          message: '已從收藏清單移除',
          duration: 2
        })
      } else {
        await api.addToWishlist(product.id)
        setIsWishlisted(true)
        notification.success({
          message: '已加入收藏清單',
          duration: 2
        })
      }
    } catch (error) {
      notification.error({
        message: '操作失敗',
        description: error.message
      })
    } finally {
      setLoading(false)
    }
  }
  
  return (
    <Button
      icon={isWishlisted ? <HeartFilled /> : <HeartOutlined />}
      onClick={handleWishlist}
      loading={loading}
      className={`${styles.wishlistBtn} ${isWishlisted ? styles.wishlisted : ''}`}
    >
      {isWishlisted ? '已收藏' : '加入收藏'}
    </Button>
  )
}
```

## 相關商品推薦

### 1. 推薦系統組件
```jsx
// components/RelatedProducts/index.jsx
const RelatedProducts = ({ product }) => {
  const [relatedProducts, setRelatedProducts] = useState([])
  const [loading, setLoading] = useState(true)
  
  useEffect(() => {
    fetchRelatedProducts()
  }, [product.id])
  
  const fetchRelatedProducts = async () => {
    try {
      const response = await api.getRelatedProducts(product.id, {
        limit: 8,
        type: 'similar' // 只要相關商品推薦，不需要"經常一起購買"
      })
      setRelatedProducts(response.data)
    } catch (error) {
      console.error('載入相關商品失敗:', error)
    } finally {
      setLoading(false)
    }
  }
  
  if (loading) return <RelatedProductsSkeleton />
  if (relatedProducts.length === 0) return null
  
  return (
    <div className={styles.relatedProducts}>
      <h3 className={styles.sectionTitle}>相關商品</h3>
      <div className={styles.productGrid}>
        {relatedProducts.map(product => (
          <ProductCard 
            key={product.id} 
            product={product}
            showQuickAdd={true}
          />
        ))}
      </div>
    </div>
  )
}
```

## SEO 優化整合

### 1. 動態 SEO Head 組件
```jsx
// components/ProductSEOHead/index.jsx
import { Helmet } from 'react-helmet-async'

const ProductSEOHead = ({ product }) => {
  const structuredData = {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": product.name,
    "image": product.images.map(img => img.url),
    "description": product.shortDescription || product.name,
    "brand": {
      "@type": "Brand",
      "name": product.brand?.name || "MickeyShop Beauty"
    },
    "offers": {
      "@type": "Offer",
      "price": product.currentPrice || product.basePrice,
      "priceCurrency": "TWD",
      "availability": product.totalStock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": product.rating,
      "reviewCount": product.reviewCount
    }
  }
  
  return (
    <Helmet>
      <title>{product.name} - {product.brand?.name || 'MickeyShop Beauty'}</title>
      <meta name="description" content={product.shortDescription || product.name} />
      <meta name="keywords" content={product.tags?.join(', ') || ''} />
      
      {/* Open Graph */}
      <meta property="og:title" content={product.name} />
      <meta property="og:description" content={product.shortDescription || product.name} />
      <meta property="og:image" content={product.images[0]?.url} />
      <meta property="og:type" content="product" />
      <meta property="og:url" content={window.location.href} />
      
      {/* Twitter Card */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={product.name} />
      <meta name="twitter:description" content={product.shortDescription || product.name} />
      <meta name="twitter:image" content={product.images[0]?.url} />
      
      {/* 結構化數據 */}
      <script type="application/ld+json">
        {JSON.stringify(structuredData)}
      </script>
    </Helmet>
  )
}
```

## 樣式設計

### 1. 主要樣式定義
```scss
// styles/ProductDetail.module.scss
.productDetailPage {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  
  .sectionTitle {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--text-color-primary);
    border-bottom: 2px solid var(--color-primary);
    padding-bottom: 10px;
  }
}

// 圖片畫廊樣式
.productGallery {
  .mainGallery {
    margin-bottom: 20px;
    
    .imageContainer {
      position: relative;
      
      &.outOfStock {
        filter: grayscale(50%);
        
        .outOfStockOverlay {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          
          .outOfStockText {
            color: white;
            font-size: 24px;
            font-weight: 600;
          }
        }
      }
    }
    
    .expandBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      border-radius: 50%;
      
      &:hover {
        background: rgba(255, 255, 255, 1);
      }
    }
  }
  
  .thumbsGallery {
    .thumbImage {
      width: 100%;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      
      &:hover {
        transform: scale(1.05);
      }
      
      &.active {
        border: 2px solid var(--color-primary);
      }
    }
  }
}

// 變體選擇樣式
.variantSelectionArea {
  .colorVariants {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    
    .colorOption {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--border-color);
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
      
      &:hover:not(.disabled) {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      
      &.selected {
        border-color: var(--color-primary);
        transform: scale(1.1);
        
        .checkIcon {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: white;
          background: var(--color-primary);
          border-radius: 50%;
          padding: 2px;
        }
      }
      
      &.disabled {
        opacity: 0.3;
        cursor: not-allowed;
        
        &::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%) rotate(45deg);
          width: 2px;
          height: 44px;
          background: #ff4d4f;
          z-index: 1;
        }
      }
      
      &.preOrder {
        border-color: #faad14;
        
        .preOrderLabel {
          position: absolute;
          bottom: -20px;
          left: 50%;
          transform: translateX(-50%);
          font-size: 10px;
          color: #faad14;
        }
      }
    }
  }
  
  .buttonVariants {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    
    .variantButton {
      min-width: 60px;
      
      &.preOrderButton {
        border-color: #faad14;
        color: #faad14;
        
        &:hover {
          background: #faad14;
          color: white;
        }
      }
    }
  }
}

// 收藏按鈕樣式
.wishlistBtn {
  &.wishlisted {
    color: #ff4d4f;
    border-color: #ff4d4f;
    
    &:hover {
      color: #ff4d4f;
      border-color: #ff4d4f;
    }
  }
}

// 響應式設計
@media (max-width: 768px) {
  .productDetailPage {
    padding: 10px;
    
    .productInfo {
      grid-template-columns: 1fr;
      gap: 20px;
    }
  }
  
  .productGallery {
    .thumbsGallery .thumbImage {
      height: 60px;
    }
  }
  
  .actionArea {
    .actionButtons {
      flex-direction: column;
      gap: 10px;
      
      .ant-btn {
        width: 100%;
      }
    }
  }
}
```

這個商品詳細頁設計文檔涵蓋了您提出的所有需求，包括縮圖導航、燈箱功能、變體選擇即時更新價格、缺貨預購處理、評價系統、社交分享、收藏功能等完整實現。