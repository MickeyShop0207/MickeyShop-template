# 網域配置架構

## 多租戶範本系統概覽

### 系統特性
- **多客戶支援：** 每個客戶獨立的 Cloudflare Pages 和 Workers
- **靈活部署：** 支援獨立域名或子域名部署
- **客戶自管理：** 客戶可自行管理內容和基礎配置
- **範本可復用：** 一套代碼支援多個客戶實例

## 配置文件架構

### 檔案結構
```
config/
├── domain.config.js          // 域名配置
├── brand.config.js           // 品牌配置  
├── theme.config.js           // 色彩主題配置
├── typography.config.js      // 字體配置
├── system.config.js          // 系統配置
└── index.js                 // 配置匯總導出
```

### 配置原則
- **集中管理：** 每類配置獨立文件，避免配置分散
- **環境變數驅動：** 所有可變參數通過環境變數控制
- **一處修改全局生效：** 配置變數統一引用，修改即生效
- **客戶獨立：** 每個客戶擁有獨立的配置實例

## 域名配置 (domain.config.js)

```javascript
export const domainConfig = {
  // 主域名設定
  primaryDomain: process.env.VITE_PRIMARY_DOMAIN || 'example.com',
  
  // 支援的域名類型
  supportedDomains: {
    primary: process.env.VITE_PRIMARY_DOMAIN,
    subdomain: process.env.VITE_SUBDOMAIN,
    customDomain: process.env.VITE_CUSTOM_DOMAIN
  },
  
  // SSL 設定
  ssl: {
    enabled: true,
    forceHttps: true
  },
  
  // CDN 設定
  cdn: {
    cloudflareZoneId: process.env.CLOUDFLARE_ZONE_ID,
    enabled: true
  },
  
  // SEO 相關
  seo: {
    canonical: process.env.VITE_CANONICAL_DOMAIN,
    robotsTxt: true,
    sitemap: true
  }
}
```

## 品牌配置 (brand.config.js)

```javascript
export const brandConfig = {
  // 品牌基本資訊
  brand: {
    name: process.env.VITE_BRAND_NAME || 'MickeyShop Beauty',
    nameEn: process.env.VITE_BRAND_NAME_EN || 'MickeyShop Beauty',
    nameZh: process.env.VITE_BRAND_NAME_ZH || '美琪美容',
    slogan: process.env.VITE_BRAND_SLOGAN || 'Your Beauty Partner',
    description: process.env.VITE_BRAND_DESCRIPTION || 'Premium Beauty Products'
  },
  
  // Logo 設定
  logo: {
    primary: process.env.VITE_LOGO_PRIMARY || '/assets/logo-primary.svg',
    secondary: process.env.VITE_LOGO_SECONDARY || '/assets/logo-secondary.svg',
    favicon: process.env.VITE_FAVICON || '/favicon.ico',
    appleTouchIcon: process.env.VITE_APPLE_TOUCH_ICON || '/apple-touch-icon.png'
  },
  
  // 品牌載入動畫設定
  loading: {
    enableBrandAnimation: true,
    animationDuration: 3000,
    typewriterSpeed: 100
  }
}
```

## 色彩主題配置 (theme.config.js)

> **整合說明**: 此配置與 `03-色彩系統與主題.md` 進行整合，作為色彩系統的数據來源。

```javascript
export const themeConfig = {
  // 主色彩配置 (客戶品牌色彩)
  colors: {
    primary: process.env.VITE_COLOR_PRIMARY || '#A66556',
    secondary: process.env.VITE_COLOR_SECONDARY || '#D4C5B9',
    accent: process.env.VITE_COLOR_ACCENT || '#B8860B',
    
    // 功能色彩 (通用，不建議修改)
    success: process.env.VITE_COLOR_SUCCESS || '#52C41A',
    warning: process.env.VITE_COLOR_WARNING || '#FAAD14',
    error: process.env.VITE_COLOR_ERROR || '#FF4D4F',
    info: process.env.VITE_COLOR_INFO || '#1677FF',
  },
  
  // 淺色主題 (與 03-色彩系統與主題.md 保持一致)
  light: {
    // 背景色彩
    bgPage: process.env.VITE_LIGHT_BG_PAGE || '#F2E8DF',
    bgComponent: process.env.VITE_LIGHT_BG_COMPONENT || '#FFFFFF',
    bgHover: process.env.VITE_LIGHT_BG_HOVER || '#F0F0F0',
    bgSelected: process.env.VITE_LIGHT_BG_SELECTED || '#E6F4FF',
    
    // 文字色彩
    textPrimary: process.env.VITE_LIGHT_TEXT_PRIMARY || '#1A1414',
    textSecondary: process.env.VITE_LIGHT_TEXT_SECONDARY || '#8B8680',
    textTertiary: process.env.VITE_LIGHT_TEXT_TERTIARY || '#C4C4C4',
  },
  
  // 深色主題 (與 03-色彩系統與主題.md 保持一致)
  dark: {
    // 背景色彩
    bgPage: process.env.VITE_DARK_BG_PAGE || '#1A1410',
    bgComponent: process.env.VITE_DARK_BG_COMPONENT || '#2D2520',
    bgHover: process.env.VITE_DARK_BG_HOVER || '#3D3530',
    bgSelected: process.env.VITE_DARK_BG_SELECTED || '#4D4540',
    
    // 文字色彩
    textPrimary: process.env.VITE_DARK_TEXT_PRIMARY || '#E8E3DE',
    textSecondary: process.env.VITE_DARK_TEXT_SECONDARY || '#9A938E',
    textTertiary: process.env.VITE_DARK_TEXT_TERTIARY || '#6A635E',
  },
  
  // 預設主題
  defaultTheme: process.env.VITE_DEFAULT_THEME || 'light',
  
  // CSS 變數生成器 (與 03 文檔整合)
  generateVariables: () => {
    const variables = {}
    
    // 品牌色彩變數
    Object.entries(themeConfig.colors).forEach(([key, value]) => {
      variables[`--brand-${key}`] = value
    })
    
    // 淺色主題變數
    Object.entries(themeConfig.light).forEach(([key, value]) => {
      const cssVar = `--light-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`
      variables[cssVar] = value
    })
    
    // 深色主題變數
    Object.entries(themeConfig.dark).forEach(([key, value]) => {
      const cssVar = `--dark-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`
      variables[cssVar] = value
    })
    
    return variables
  }
}

// 導出獨立的 CSS 變數生成器
export const generateThemeCSS = () => {
  const variables = themeConfig.generateVariables()
  
  return Object.entries(variables)
    .map(([key, value]) => `${key}: ${value};`)
    .join('\n  ')
}
```

## 字體配置 (typography.config.js)

```javascript
export const typographyConfig = {
  // 字體族群
  fonts: {
    primary: {
      name: process.env.VITE_FONT_PRIMARY || 'Noto Serif Display',
      fallback: 'serif',
      googleFonts: process.env.VITE_GOOGLE_FONTS_PRIMARY || 'Noto+Serif+Display:wght@300;400;600;700',
      weights: [300, 400, 600, 700]
    },
    
    chinese: {
      name: process.env.VITE_FONT_CHINESE || 'iansui',
      fallback: 'sans-serif',
      customFont: process.env.VITE_CUSTOM_FONT_CHINESE || '/fonts/iansui.woff2',
      weights: [400, 500, 600]
    },
    
    system: {
      name: 'system-ui',
      fallback: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'
    }
  },
  
  // 字體大小配置
  sizes: {
    xs: process.env.VITE_FONT_SIZE_XS || '0.75rem',
    sm: process.env.VITE_FONT_SIZE_SM || '0.875rem',
    base: process.env.VITE_FONT_SIZE_BASE || '1rem',
    lg: process.env.VITE_FONT_SIZE_LG || '1.125rem',
    xl: process.env.VITE_FONT_SIZE_XL || '1.25rem',
    '2xl': process.env.VITE_FONT_SIZE_2XL || '1.5rem',
    '3xl': process.env.VITE_FONT_SIZE_3XL || '1.875rem',
    '4xl': process.env.VITE_FONT_SIZE_4XL || '2.25rem'
  },
  
  // 字體載入策略
  loading: {
    strategy: 'swap',
    preload: true,
    display: 'swap'
  }
}
```

## 系統配置 (system.config.js)

```javascript
export const systemConfig = {
  // 應用基本資訊
  app: {
    name: process.env.VITE_APP_NAME || 'MickeyShop Beauty',
    version: process.env.VITE_APP_VERSION || '1.0.0',
    environment: process.env.VITE_ENVIRONMENT || 'production'
  },
  
  // API 設定
  api: {
    baseUrl: process.env.VITE_API_BASE_URL,
    timeout: 10000,
    retryAttempts: 3
  },
  
  // Cloudflare 設定
  cloudflare: {
    accountId: process.env.CLOUDFLARE_ACCOUNT_ID,
    kvNamespace: process.env.CLOUDFLARE_KV_NAMESPACE,
    workersUrl: process.env.VITE_WORKERS_URL
  },
  
  // 功能開關
  features: {
    pwa: process.env.VITE_ENABLE_PWA === 'true',
    analytics: process.env.VITE_ENABLE_ANALYTICS === 'true',
    animations: process.env.VITE_ENABLE_ANIMATIONS !== 'false',
    darkMode: process.env.VITE_ENABLE_DARK_MODE !== 'false'
  },
  
  // 語言設定
  i18n: {
    defaultLocale: process.env.VITE_DEFAULT_LOCALE || 'zh',
    supportedLocales: ['zh', 'en'],
    fallbackLocale: 'en'
  }
}
```

## 配置匯總與工具函數 (config/index.js)

```javascript
import { domainConfig } from './domain.config.js'
import { brandConfig } from './brand.config.js'
import { themeConfig } from './theme.config.js'
import { typographyConfig } from './typography.config.js'
import { systemConfig } from './system.config.js'

// 統一導出所有配置
export const config = {
  domain: domainConfig,
  brand: brandConfig,
  theme: themeConfig,
  typography: typographyConfig,
  system: systemConfig
}

// 生成 CSS 變數的函數
export const generateCSSVariables = () => {
  const { theme } = config
  
  const lightVariables = Object.entries(theme.light)
    .map(([key, value]) => `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${value};`)
    .join('\n  ')
    
  const darkVariables = Object.entries(theme.dark)
    .map(([key, value]) => `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${value};`)
    .join('\n  ')
    
  const colorVariables = Object.entries(theme.colors)
    .map(([key, value]) => `--color-${key}: ${value};`)
    .join('\n  ')

  return {
    light: lightVariables,
    dark: darkVariables,
    colors: colorVariables
  }
}

// 獲取當前環境配置
export const getCurrentConfig = () => {
  return {
    domain: config.domain.primaryDomain,
    brand: config.brand.brand.name,
    theme: config.theme.defaultTheme,
    environment: config.system.app.environment
  }
}

// 驗證必要配置
export const validateConfig = () => {
  const required = [
    config.domain.primaryDomain,
    config.brand.brand.name,
    config.theme.colors.primary
  ]
  
  return required.every(value => value && value.length > 0)
}

// 導出單獨配置（向下兼容）
export { domainConfig, brandConfig, themeConfig, typographyConfig, systemConfig }
```

## 環境變數模板 (.env.example)

```bash
# 域名配置
VITE_PRIMARY_DOMAIN=example.com
VITE_CANONICAL_DOMAIN=https://example.com

# 品牌配置
VITE_BRAND_NAME=MickeyShop Beauty
VITE_BRAND_NAME_EN=MickeyShop Beauty
VITE_BRAND_NAME_ZH=美琪美容
VITE_BRAND_SLOGAN=Your Beauty Partner
VITE_BRAND_DESCRIPTION=Premium Beauty Products

# Logo 配置
VITE_LOGO_PRIMARY=/assets/logo-primary.svg
VITE_LOGO_SECONDARY=/assets/logo-secondary.svg
VITE_FAVICON=/favicon.ico

# 色彩配置 (與 03-色彩系統與主題.md 整合)
# 品牌主色彩 (客戶可客製化)
VITE_COLOR_PRIMARY=#A66556
VITE_COLOR_SECONDARY=#D4C5B9
VITE_COLOR_ACCENT=#B8860B

# 功能色彩 (建議保持預設值)
VITE_COLOR_SUCCESS=#52C41A
VITE_COLOR_WARNING=#FAAD14
VITE_COLOR_ERROR=#FF4D4F
VITE_COLOR_INFO=#1677FF

# 淺色主題配置
VITE_LIGHT_BG_PAGE=#F2E8DF
VITE_LIGHT_BG_COMPONENT=#FFFFFF
VITE_LIGHT_BG_HOVER=#F0F0F0
VITE_LIGHT_BG_SELECTED=#E6F4FF
VITE_LIGHT_TEXT_PRIMARY=#1A1414
VITE_LIGHT_TEXT_SECONDARY=#8B8680
VITE_LIGHT_TEXT_TERTIARY=#C4C4C4

# 深色主題配置
VITE_DARK_BG_PAGE=#1A1410
VITE_DARK_BG_COMPONENT=#2D2520
VITE_DARK_BG_HOVER=#3D3530
VITE_DARK_BG_SELECTED=#4D4540
VITE_DARK_TEXT_PRIMARY=#E8E3DE
VITE_DARK_TEXT_SECONDARY=#9A938E
VITE_DARK_TEXT_TERTIARY=#6A635E

# 主題預設設定
VITE_DEFAULT_THEME=light

# 字體配置
VITE_FONT_PRIMARY=Noto Serif Display
VITE_FONT_CHINESE=iansui
VITE_GOOGLE_FONTS_PRIMARY=Noto+Serif+Display:wght@300;400;600;700

# Cloudflare 配置
CLOUDFLARE_ACCOUNT_ID=your-account-id
CLOUDFLARE_ZONE_ID=your-zone-id
CLOUDFLARE_KV_NAMESPACE=your-kv-namespace
VITE_WORKERS_URL=https://your-worker.your-subdomain.workers.dev

# 功能開關
VITE_ENABLE_PWA=true
VITE_ENABLE_ANALYTICS=true
VITE_ENABLE_ANIMATIONS=true
VITE_ENABLE_DARK_MODE=true

# 系統配置
VITE_APP_VERSION=1.0.0
VITE_ENVIRONMENT=production
VITE_DEFAULT_LOCALE=zh
```

## 使用方式

### 在組件中使用配置
```javascript
import { config } from '@/config'

// 使用品牌名稱
const brandName = config.brand.brand.name

// 使用主色彩
const primaryColor = config.theme.colors.primary

// 使用字體配置
const primaryFont = config.typography.fonts.primary.name
```

### 在樣式中使用變數 (與 03 文檔整合)
```scss
// 使用配置驅動的 CSS 變數
.component {
  // 背景色彩 (自動適應主題)
  background-color: var(--bg-component);
  color: var(--text-primary);
  
  // 品牌色彩 (客戶客製化)
  border-color: var(--color-primary);
  
  // 懸停狀態
  &:hover {
    background-color: var(--bg-hover);
  }
  
  // 選中狀態
  &.selected {
    background-color: var(--color-primary);
    color: var(--text-primary);
  }
}

// 使用品牌色彩的組件
.brand-button {
  background: linear-gradient(135deg, 
    var(--color-primary) 0%, 
    var(--color-secondary) 100%);
  border: 1px solid var(--color-accent);
}
```

### 在 Vite 配置中使用
```javascript
import { config } from './src/config'

export default defineConfig({
  define: {
    __BRAND_NAME__: JSON.stringify(config.brand.brand.name),
    __PRIMARY_COLOR__: JSON.stringify(config.theme.colors.primary)
  }
})
```

## 部署與SSG策略

### SSG混合策略實現

#### 構建時預生成
```js
// 預生成策略
- 熱門商品前100名
- 主要分類頁面
- 品牌頁面
- 促銷頁面
```

#### 首次訪問時生成
```js
// 動態生成流程
1. 管理員在後台新增商品
2. 用戶首次訪問該商品頁面
3. 服務端動態生成HTML
4. 存入Cloudflare KV快取
5. 後續訪問從KV讀取
```

#### Cloudflare KV快取策略
```js
// 快取生命週期
- 商品詳情頁面: 24小時快取
- 商品列表頁面: 1小時快取  
- 分類頁面: 12小時快取
- 搜索結果: 30分鐘快取

// 快取失效機制
const invalidateProductCache = async (productId) => {
  await Promise.all([
    KV.delete(`product:${productId}`),
    KV.delete(`product-list:category:${category}`),
    KV.delete(`search:${relatedKeywords}`)
  ])
}
```

### Vite配置整合
```js
// vite.config.js
export default defineConfig({
  plugins: [
    react(),
    // SSG配置
    generateSitemap(),
    prerender({
      routes: [
        '/', 
        '/products',
        ...hotProductRoutes // 熱門商品路由
      ],
      onDemand: true // 支援按需生成
    })
  ],
  define: {
    __BRAND_NAME__: JSON.stringify(config.brand.brand.name),
    __PRIMARY_COLOR__: JSON.stringify(config.theme.colors.primary)
  }
})
```

## 部署流程

### 客戶配置步驟
1. **複製範本：** 從範本倉庫複製代碼
2. **配置環境變數：** 根據 `.env.example` 創建 `.env` 文件
3. **上傳資源：** 上傳品牌 Logo 和自定義字體文件
4. **部署到 Cloudflare Pages：** 連接倉庫並設置環境變數
5. **配置自定義域名：** 在 Cloudflare 中設置域名指向
6. **設置KV存儲：** 配置商品快取和用戶數據存儲
7. **配置Workers：** 設置動態頁面生成和API處理

### 商品管理工作流程

#### 後台新增商品
1. **管理員操作**: 在後台管理頁新增商品資料
2. **資料庫更新**: 商品資料存入資料庫
3. **快取標記**: 標記該商品需要生成頁面
4. **即時生效**: 商品立即可在列表頁顯示

#### 首次頁面生成
1. **用戶訪問**: 首次訪問新商品頁面
2. **檢測快取**: 檢查Cloudflare KV是否有快取
3. **動態生成**: 無快取時動態生成HTML
4. **存入快取**: 生成的HTML存入KV
5. **返回頁面**: 返回完整的商品詳情頁

#### 頁面更新機制
```js
// 商品資料更新時
1. 管理員修改商品資料
2. 清除對應的KV快取
3. 下次訪問時重新生成
4. 新頁面存入快取
```

### 維護更新流程
1. **範本更新：** 更新核心功能代碼
2. **客戶同步：** 客戶拉取最新範本更新
3. **配置保持：** 客戶配置文件和環境變數保持不變
4. **測試部署：** 在測試環境驗證更新
5. **生產部署：** 部署到生產環境

### 性能與SEO優勢

#### 開發優勢
- ✅ 管理員可自由新增商品，無需程式碼修改
- ✅ 新商品2-3分鐘內即可上線
- ✅ 無需重新部署整個網站

#### 性能優勢  
- ✅ 熱門商品載入速度極快(靜態頁面)
- ✅ 新商品首次載入後速度等同靜態頁面
- ✅ 減少API請求，降低伺服器負載

#### SEO優勢
- ✅ 所有商品頁面都是完整的HTML
- ✅ 搜索引擎可正常索引所有商品
- ✅ 支援動態meta標籤和結構化數據

## 優勢特點

### 開發維護優勢
- **配置集中：** 所有配置集中管理，易於維護
- **環境分離：** 開發、測試、生產環境配置分離
- **類型安全：** 配置結構清晰，支援 TypeScript
- **熱更新：** 開發環境支援配置熱更新

### 客戶使用優勢
- **簡單部署：** 只需配置環境變數即可部署
- **品牌客製化：** 輕鬆更換品牌元素
- **域名靈活：** 支援多種域名配置方式
- **獨立管理：** 每個客戶獨立的配置和部署