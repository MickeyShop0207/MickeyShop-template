# åœ‹éš›åŒ–å¯¦ç¾ç­–ç•¥

## æ”¯æ´èªè¨€èˆ‡è²¨å¹£

### èªè¨€æ”¯æ´
- **ä¸»è¦èªè¨€**: ç¹é«”ä¸­æ–‡ (zh-TW)
- **æ¬¡è¦èªè¨€**: è‹±æ–‡ (en)
- **æ“´å±•æ€§**: æ”¯æ´æœªä¾†æ–°å¢èªè¨€

### è²¨å¹£æ”¯æ´
- **ä¸»è¦è²¨å¹£**: æ–°å°å¹£ (TWD)
- **æ¬¡è¦è²¨å¹£**: ç¾é‡‘ (USD)
- **æ“´å±•æ€§**: æ”¯æ´æœªä¾†æ–°å¢è²¨å¹£

## åœ°å€æª¢æ¸¬ç­–ç•¥

### Cloudflareåœ°ç†ä½ç½®æª¢æ¸¬
```js
// æª¢æ¸¬å„ªå…ˆåº
1. URL åƒæ•¸ (?lang=zh-TW&currency=TWD)
2. localStorage å„²å­˜çš„ç”¨æˆ¶åå¥½
3. Cloudflare request.cf.country
4. Accept-Language HTTP header
5. é è¨­å€¼ (zh-TW/TWD)
```

### åœ‹å®¶æ˜ å°„é…ç½®
```js
const REGION_MAPPING = {
  'TW': { locale: 'zh-TW', currency: 'TWD', phonePrefix: '+886' },
  'US': { locale: 'en', currency: 'USD', phonePrefix: '+1' },
  'CN': { locale: 'zh-TW', currency: 'TWD', phonePrefix: '+86' },
  'HK': { locale: 'zh-TW', currency: 'TWD', phonePrefix: '+852' },
  'SG': { locale: 'en', currency: 'USD', phonePrefix: '+65' }
}
```

## è·¯ç”±åœ‹éš›åŒ–

### URLçµæ§‹è¦ç¯„
- **èªè¨€å‰ç¶´**: æ‰€æœ‰è·¯ç”±åŒ…å« `:locale` å‰ç¶´
- **æ”¯æ´èªè¨€**: `zh-TW`, `en`
- **é è¨­èªè¨€**: æ ¹æ“šCloudflareåœ°ç†æª¢æ¸¬
- **æ ¼å¼**: `/:locale/path` (ä¾‹: `example.com/zh-TW/products`)
- **æ”¯æ´è·¯ç”±**: æ‰€æœ‰å‰å°é é¢
- **æ ¹è·¯å¾‘è™•ç†**: è‡ªå‹•é‡å°å‘åˆ°æª¢æ¸¬åˆ°çš„èªè¨€

### å®Œæ•´è·¯ç”±æ¶æ§‹

#### å•†å“è·¯ç”±
```
/:locale/product/å•†å“åˆ†é¡/å•†å“åç¨±
```
- **å•†å“åˆ†é¡**: å¾Œå°ç®¡ç†å“¡å¯è¨­å®š
- **å•†å“åç¨±**: å¾Œå°ç®¡ç†å“¡å¯è¨­å®š
- **ç¯„ä¾‹**: `/zh-TW/product/skincare/è˜­è”»å°é»‘ç“¶ç²¾è¯`

#### ç”¨æˆ¶è·¯ç”±
```
/:locale/user/é é¢åç¨±
```
- **ç¯„ä¾‹**: `/zh-TW/user/profile`, `/zh-TW/user/orders`

#### æœç´¢è·¯ç”±
```
/:locale/search/keywords
```
- **åŸºç¤æœç´¢**: `/zh-TW/search/ä¿æ¿•ç²¾è¯`
- **SEOå‹å¥½ç¯©é¸**: `/zh-TW/search/ä¿æ¿•ç²¾è¯/brand-è˜­è”»-é›…è©©è˜­é»›/price-1000-5000`

#### è³¼ç‰©æµç¨‹è·¯ç”±
```
/:locale/cart â†’ /:locale/checkout â†’ /:locale/checkout/payment â†’ /:locale/checkout/success
```

### å°èˆªæ¶æ§‹è¨­è¨ˆ

#### æ¡Œé¢ç‰ˆé ‚éƒ¨å°èˆªåˆ—
**å·¦å´åŠŸèƒ½å€**:
- å¹£ç¨®åˆ‡æ›
- èªè¨€åˆ‡æ›  
- æœå°‹æ¡†

**å³å´å°èˆªå€** (èˆ‡æ‰‹æ©Ÿç‰ˆåº•éƒ¨å°èˆªä¸€è‡´):
1. **é¦–é **: `/:locale/`
2. **ç†±é–€å•†å“**: `/:locale/trending`
3. **æ”¶è—æ¸…å–®**: `/:locale/user/wishlist`
4. **é€šçŸ¥**: `/:locale/user/notifications`
5. **è³¼ç‰©è»Š**: `/:locale/cart`
6. **æœƒå“¡ä¸­å¿ƒ**: `/:locale/user/profile`

#### æ‰‹æ©Ÿç‰ˆå°èˆªè¨­è¨ˆ

**é ‚éƒ¨å°èˆªåˆ—**:
- å¹£ç¨®åˆ‡æ›
- èªè¨€åˆ‡æ›
- æœå°‹æ¡†

**åº•éƒ¨å°èˆªåˆ—**:
1. **é¦–é **: `/:locale/`
2. **ç†±é–€å•†å“**: `/:locale/trending`
3. **æ”¶è—æ¸…å–®**: `/:locale/user/wishlist`
4. **é€šçŸ¥**: `/:locale/user/notifications`
5. **è³¼ç‰©è»Š**: `/:locale/cart`
6. **æœƒå“¡ä¸­å¿ƒ**: `/:locale/user/profile`

### React Routeré…ç½®
```js
const routes = [
  {
    path: '/:locale',
    element: <I18nWrapper />,
    children: [
      // é¦–é èˆ‡åŸºæœ¬é é¢
      { path: '', element: <HomePage /> },
      { path: 'trending', element: <TrendingPage /> },
      
      // å•†å“ç›¸é—œè·¯ç”±
      { path: 'product/:category/:productName', element: <ProductDetailPage /> },
      { path: 'products', element: <ProductsPage /> },
      { path: 'products/:category', element: <CategoryPage /> },
      
      // æœç´¢è·¯ç”±
      { path: 'search/:keywords', element: <SearchPage /> },
      { path: 'search/:keywords/*', element: <SearchPage /> }, // åŒ…å«ç¯©é¸åƒæ•¸
      
      // ç”¨æˆ¶è·¯ç”±
      { path: 'user/profile', element: <ProfilePage /> },
      { path: 'user/orders', element: <OrdersPage /> },
      { path: 'user/wishlist', element: <WishlistPage /> },
      { path: 'user/notifications', element: <NotificationsPage /> },
      
      // è³¼ç‰©æµç¨‹è·¯ç”±
      { path: 'cart', element: <CartPage /> },
      { path: 'checkout', element: <CheckoutPage /> },
      { path: 'checkout/payment', element: <PaymentPage /> },
      { path: 'checkout/success', element: <SuccessPage /> }
    ]
  },
  // æ ¹è·¯å¾‘è‡ªå‹•é‡å°å‘
  { path: '/', element: <LocaleRedirect /> }
]
```

### è·¯ç”±ç­–ç•¥
- **çµ±ä¸€å°èˆª**: æ¡Œé¢ç‰ˆå³å´å°èˆªèˆ‡æ‰‹æ©Ÿç‰ˆåº•éƒ¨å°èˆªå®Œå…¨ä¸€è‡´ï¼Œç¢ºä¿è·¨è¨­å‚™çš„æ“ä½œä¸€è‡´æ€§
- **SEOå„ªåŒ–**: 
  - **è·¯å¾‘ç·¨ç¢¼**: ä½¿ç”¨è·¯å¾‘è€ŒéURLåƒæ•¸
  - **èªè¨€å‰ç¶´**: ä¾¿æ–¼æœç´¢å¼•æ“ç†è§£å¤šèªè¨€å…§å®¹
  - **éœæ…‹ç”Ÿæˆ**: æ”¯æŒç†±é–€é é¢SSG

## React-i18next æ¶æ§‹

### æŠ€è¡“é¸å‹
- **æ ¸å¿ƒåº«**: react-i18next
- **ç‰ˆæœ¬**: ^13.0.0
- **è¼‰å…¥ç­–ç•¥**: æŒ‰éœ€è¼‰å…¥
- **æª¢æ¸¬å™¨**: i18next-browser-languagedetector
- **å¾Œç«¯è¼‰å…¥å™¨**: i18next-http-backend

### æ ¸å¿ƒåŠŸèƒ½
- ç¿»è­¯æ–‡ä»¶å‹•æ…‹è¼‰å…¥
- åƒæ•¸æ’å€¼èˆ‡è¤‡æ•¸å½¢å¼
- å‘½åç©ºé–“æŒ‰éœ€è¼‰å…¥
- èªè¨€è‡ªå‹•æª¢æ¸¬
- å®Œæ•´çš„å›é€€èªè¨€æ©Ÿåˆ¶
- TypeScriptå‹åˆ¥å®‰å…¨

### ç¿»è­¯æ–‡ä»¶çµæ§‹
```
locales/
â”œâ”€â”€ zh-TW/
â”‚   â”œâ”€â”€ common.json          # é€šç”¨æ–‡å­—
â”‚   â”œâ”€â”€ navigation.json      # å°èˆªé¸å–®
â”‚   â”œâ”€â”€ products.json        # å•†å“ç›¸é—œ
â”‚   â”œâ”€â”€ cart.json           # è³¼ç‰©è»Š
â”‚   â”œâ”€â”€ checkout.json       # çµå¸³æµç¨‹
â”‚   â”œâ”€â”€ user.json           # ç”¨æˆ¶ç›¸é—œ
â”‚   â”œâ”€â”€ forms.json          # è¡¨å–®é©—è­‰
â”‚   â”œâ”€â”€ errors.json         # éŒ¯èª¤è¨Šæ¯
â”‚   â”œâ”€â”€ currency.json       # è²¨å¹£é¡¯ç¤º
â”‚   â””â”€â”€ seo.json           # SEOå…ƒè³‡æ–™
â””â”€â”€ en/
    â””â”€â”€ (ç›¸åŒçµæ§‹)
```

## è²¨å¹£è™•ç†ç­–ç•¥

### APIè²¨å¹£æ”¯æ´
- **æ•¸æ“šä¾†æº**: APIè¿”å›æ‰€æœ‰è²¨å¹£åƒ¹æ ¼
- **åŒ¯ç‡æ›´æ–°**: æ¯æ—¥æ›´æ–°å›ºå®šåŒ¯ç‡
- **åƒ¹æ ¼é¡¯ç¤º**: ä¸é¡¯ç¤ºåŸåƒ¹è²¨å¹£

### è²¨å¹£æ ¼å¼é…ç½®
```json
{
  "TWD": {
    "symbol": "NT$",
    "code": "TWD",
    "decimals": 0,
    "position": "before"
  },
  "USD": {
    "symbol": "$",
    "code": "USD", 
    "decimals": 2,
    "position": "before"
  }
}
```

## è¡¨å–®é©—è­‰åœ‹éš›åŒ–

### åœ°å€é©—è­‰è¦å‰‡
```js
const VALIDATION_RULES = {
  'zh-TW': {
    phone: /^(\+886|0)?[0-9]{8,10}$/,
    idNumber: /^[A-Z][1-2]\d{8}$/,
    postcode: /^\d{3,5}$/
  },
  'en': {
    phone: /^(\+1)?[0-9]{10}$/,
    ssn: /^\d{3}-\d{2}-\d{4}$/,
    zipcode: /^\d{5}(-\d{4})?$/
  }
}
```

### å‹•æ…‹é©—è­‰è¼‰å…¥
- æ ¹æ“šç”¨æˆ¶é¸æ“‡çš„é›»è©±åœ‹ç¢¼å‹•æ…‹è¼‰å…¥é©—è­‰è¦å‰‡
- æ”¯æ´åœ°å€æ ¼å¼é©—è­‰
- èº«ä»½è­‰è™Ÿç¢¼æ ¼å¼é©—è­‰

## æ—¥æœŸæ™‚é–“æ ¼å¼

### åœ°å€æ ¼å¼é…ç½®
```js
const DATETIME_FORMATS = {
  'zh-TW': {
    date: 'YYYY/MM/DD',
    time: 'HH:mm',
    datetime: 'YYYY/MM/DD HH:mm'
  },
  'en': {
    date: 'MM/DD/YYYY',
    time: 'hh:mm A',
    datetime: 'MM/DD/YYYY hh:mm A'
  }
}
```

## APIåœ‹éš›åŒ–æ•´åˆ

### è«‹æ±‚é ­è¨­å®š
```js
apiClient.interceptors.request.use((config) => {
  config.headers['Accept-Language'] = locale
  config.headers['Accept-Currency'] = currency
  return config
})
```

### å…§å®¹ç¿»è­¯ç¯„åœ
- æ‰€æœ‰UIä»‹é¢æ–‡å­—
- å•†å“åç¨±èˆ‡æè¿°
- å“ç‰Œåç¨±
- åˆ†é¡åç¨±
- SEOå…ƒè³‡æ–™

## React-i18next å¯¦éš›é…ç½®

### åˆå§‹åŒ–é…ç½®
```js
// i18n/index.js
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import Backend from 'i18next-http-backend'
import LanguageDetector from 'i18next-browser-languagedetector'

i18n
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    lng: 'zh-TW',
    fallbackLng: 'zh-TW',
    
    // æŒ‰éœ€è¼‰å…¥è¨­å®š
    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json'
    },
    
    // å‘½åç©ºé–“è¨­å®š
    ns: ['common'],
    defaultNS: 'common',
    
    // æ€§èƒ½å„ªåŒ–
    load: 'currentOnly', // åªè¼‰å…¥ç•¶å‰èªè¨€
    preload: false, // ä¸é è¼‰å…¥
    
    // Cloudflareåœ°ç†æª¢æ¸¬æ•´åˆ
    detection: {
      order: ['querystring', 'localStorage', 'cookie', 'navigator'],
      lookupQuerystring: 'lang',
      lookupLocalStorage: 'locale-preference',
      lookupCookie: 'locale',
      caches: ['localStorage', 'cookie']
    },
    
    interpolation: {
      escapeValue: false
    }
  })

export default i18n
```

### Hookä½¿ç”¨ç¯„ä¾‹
```jsx
// åŸºç¤ä½¿ç”¨
const { t } = useTranslation()

// å‘½åç©ºé–“æŒ‰éœ€è¼‰å…¥
const { t } = useTranslation(['products', 'cart'])

// è¼‰å…¥ç‹€æ…‹è™•ç†
const { t, ready } = useTranslation('products')
if (!ready) return <Loading />

// è¤‡æ•¸å½¢å¼
t('itemCount', { count: 5 }) // "5 items" æˆ– "5 å€‹é …ç›®"
```

### èªè¨€åˆ‡æ›å¯¦ç¾
```js
// utils/language-switcher.js
import i18n from '@/i18n'
import { useNavigate } from 'react-router-dom'

export const changeLanguage = async (lng, navigate) => {
  // æ›´æ–°i18nèªè¨€
  await i18n.changeLanguage(lng)
  
  // å­˜å„²ç”¨æˆ¶åå¥½
  localStorage.setItem('locale-preference', lng)
  document.cookie = `locale=${lng}; path=/; max-age=31536000` // 1å¹´
  
  // æ›´æ–°HTML langå±¬æ€§
  document.documentElement.lang = lng
  
  // æ›´æ–°è·¯ç”±ï¼ˆä½¿ç”¨React Routerï¼‰
  const currentPath = window.location.pathname
  const pathWithoutLocale = currentPath.replace(/^\/(zh-TW|en)/, '')
  const newPath = `/${lng}${pathWithoutLocale}`
  
  if (navigate) {
    navigate(newPath, { replace: true })
  } else {
    window.location.href = newPath
  }
  
  // è§¸ç™¼å…¨å±€èªè¨€è®Šæ›´äº‹ä»¶
  window.dispatchEvent(new CustomEvent('localeChange', { detail: lng }))
}

// React Hook for language switching
import { useNavigate } from 'react-router-dom'
export const useLanguageSwitcher = () => {
  const navigate = useNavigate()
  
  return {
    switchLanguage: (lng) => changeLanguage(lng, navigate),
    currentLanguage: i18n.language
  }
}
```

## ç¿»è­¯å…§å®¹ç®¡ç†

### ç®¡ç†ç­–ç•¥
- **ç¶­è­·æ–¹å¼**: å¾Œå°ç®¡ç†é ç¶­è­·
- **ç®¡ç†ç¯„åœ**: æ‰€æœ‰å‰å°æ–‡å­—
- **å¾Œå°èªè¨€**: åªæ”¯æ´ç¹é«”ä¸­æ–‡
- **æ¬Šé™æ§åˆ¶**: ç®¡ç†å“¡æ¬Šé™

### å…§å®¹åŒæ­¥
- æ–°å¢èªè¨€æ™‚è‡ªå‹•å‰µå»ºå°æ‡‰ç¿»è­¯æ–‡ä»¶
- æ”¯æ´æ‰¹é‡ç¿»è­¯åŒ¯å…¥åŒ¯å‡º
- ç¼ºå¤±ç¿»è­¯è‡ªå‹•å›é€€åˆ°é è¨­èªè¨€
- æ”¯æ´ react-i18next çš„ saveMissing åŠŸèƒ½

### TypeScript å‹åˆ¥å®‰å…¨
```ts
// types/i18next.d.ts
import 'react-i18next'
import commonZhTW from '@/locales/zh-TW/common.json'
import productsZhTW from '@/locales/zh-TW/products.json'
import cartZhTW from '@/locales/zh-TW/cart.json'
import checkoutZhTW from '@/locales/zh-TW/checkout.json'
import userZhTW from '@/locales/zh-TW/user.json'
import formsZhTW from '@/locales/zh-TW/forms.json'

declare module 'react-i18next' {
  interface CustomTypeOptions {
    defaultNS: 'common'
    resources: {
      common: typeof commonZhTW
      navigation: typeof navigationZhTW
      products: typeof productsZhTW
      cart: typeof cartZhTW
      checkout: typeof checkoutZhTW
      user: typeof userZhTW
      forms: typeof formsZhTW
      errors: typeof errorsZhTW
      currency: typeof currencyZhTW
      seo: typeof seoZhTW
    }
  }
}
```

## å¯¦ç¾çµ„ä»¶èˆ‡Hook

### LocaleProviderçµ„ä»¶
```jsx
// components/LocaleProvider.jsx
import React, { createContext, useContext, useEffect, useState } from 'react'
import { useParams, Navigate } from 'react-router-dom'
import { ConfigProvider } from 'antd'
import zhTW from 'antd/locale/zh_TW'
import enUS from 'antd/locale/en_US'
import { useTranslation } from 'react-i18next'

const LocaleContext = createContext()

const SUPPORTED_LOCALES = ['zh-TW', 'en']
const LOCALE_CONFIG = {
  'zh-TW': {
    antdLocale: zhTW,
    dateFormat: 'YYYY/MM/DD',
    timeFormat: 'HH:mm',
    numberFormat: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
    currencySymbol: 'NT$'
  },
  'en': {
    antdLocale: enUS,
    dateFormat: 'MM/DD/YYYY', 
    timeFormat: 'hh:mm A',
    numberFormat: { minimumFractionDigits: 2, maximumFractionDigits: 2 },
    currencySymbol: '$'
  }
}

export const LocaleProvider = ({ children }) => {
  const { locale } = useParams()
  const { i18n } = useTranslation()
  const [currentLocale, setCurrentLocale] = useState(locale || 'zh-TW')
  
  // é©—è­‰èªè¨€åƒæ•¸æœ‰æ•ˆæ€§
  if (!SUPPORTED_LOCALES.includes(locale)) {
    return <Navigate to="/zh-TW" replace />
  }
  
  useEffect(() => {
    if (locale && locale !== i18n.language) {
      i18n.changeLanguage(locale)
      setCurrentLocale(locale)
      document.documentElement.lang = locale
    }
  }, [locale, i18n])
  
  const localeConfig = LOCALE_CONFIG[currentLocale]
  
  const value = {
    locale: currentLocale,
    setLocale: setCurrentLocale,
    config: localeConfig,
    isRTL: false // å¯æ“´å±•æ”¯æ´é˜¿æ‹‰ä¼¯èªç­‰RTLèªè¨€
  }
  
  return (
    <LocaleContext.Provider value={value}>
      <ConfigProvider locale={localeConfig.antdLocale}>
        {children}
      </ConfigProvider>
    </LocaleContext.Provider>
  )
}

export const useLocale = () => {
  const context = useContext(LocaleContext)
  if (!context) {
    // ä½¿ç”¨çµ±ä¸€éŒ¯èª¤è™•ç†ç³»çµ±
    import('@/stores/error-handler').then(({ useErrorHandler }) => {
      useErrorHandler.getState().handleError(
        new Error('useLocale must be used within LocaleProvider'),
        { type: 'hook-usage', hook: 'useLocale' }
      )
    })
    throw new Error('useLocale must be used within LocaleProvider')
  }
  return context
}
```

### èªè¨€åˆ‡æ›çµ„ä»¶
```jsx
// components/LanguageSwitcher.jsx
import React from 'react'
import { Select, Button } from 'antd'
import { GlobalOutlined } from '@ant-design/icons'
import { useLanguageSwitcher } from '@/utils/language-switcher'
import { useTranslation } from 'react-i18next'

const LANGUAGE_OPTIONS = [
  { value: 'zh-TW', label: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼' },
  { value: 'en', label: 'English', flag: 'ğŸ‡ºğŸ‡¸' }
]

export const LanguageSwitcher = ({ type = 'select' }) => {
  const { switchLanguage, currentLanguage } = useLanguageSwitcher()
  const { t } = useTranslation('common')
  
  if (type === 'dropdown') {
    return (
      <Select
        value={currentLanguage}
        onChange={switchLanguage}
        suffixIcon={<GlobalOutlined />}
        style={{ minWidth: 120 }}
      >
        {LANGUAGE_OPTIONS.map(option => (
          <Select.Option key={option.value} value={option.value}>
            <span style={{ marginRight: 8 }}>{option.flag}</span>
            {option.label}
          </Select.Option>
        ))}
      </Select>
    )
  }
  
  return (
    <div className="language-switcher">
      {LANGUAGE_OPTIONS.map(option => (
        <Button
          key={option.value}
          type={currentLanguage === option.value ? 'primary' : 'text'}
          size="small"
          onClick={() => switchLanguage(option.value)}
        >
          <span style={{ marginRight: 4 }}>{option.flag}</span>
          {option.label}
        </Button>
      ))}
    </div>
  )
}
```

### è²¨å¹£æ ¼å¼åŒ–Hook
```js
// hooks/useCurrency.js
import { useLocale } from '@/components/LocaleProvider'
import { useTranslation } from 'react-i18next'

export const useCurrency = () => {
  const { locale, config } = useLocale()
  const { t } = useTranslation('currency')
  
  const formatCurrency = (amount, currency = 'TWD') => {
    const currencySymbols = {
      'TWD': 'NT$',
      'USD': '$'
    }
    
    const symbol = currencySymbols[currency] || config.currencySymbol
    const formattedAmount = new Intl.NumberFormat(locale, {
      ...config.numberFormat,
      style: 'decimal'
    }).format(amount)
    
    return `${symbol}${formattedAmount}`
  }
  
  const formatPrice = (prices, targetCurrency = 'TWD') => {
    // prices: { TWD: 1200, USD: 40 }
    const amount = prices[targetCurrency]
    return formatCurrency(amount, targetCurrency)
  }
  
  return {
    formatCurrency,
    formatPrice,
    currentCurrency: locale === 'en' ? 'USD' : 'TWD'
  }
}
```

### æ—¥æœŸæ ¼å¼åŒ–Hook  
```js
// hooks/useDateTime.js
import { useLocale } from '@/components/LocaleProvider'
import dayjs from 'dayjs'

export const useDateTime = () => {
  const { locale, config } = useLocale()
  
  const formatDate = (date) => {
    return dayjs(date).format(config.dateFormat)
  }
  
  const formatTime = (date) => {
    return dayjs(date).format(config.timeFormat)
  }
  
  const formatDateTime = (date) => {
    return dayjs(date).format(`${config.dateFormat} ${config.timeFormat}`)
  }
  
  const formatRelative = (date) => {
    const now = dayjs()
    const target = dayjs(date)
    const diffHours = now.diff(target, 'hour')
    const diffDays = now.diff(target, 'day')
    
    if (diffHours < 24) {
      return `${diffHours} å°æ™‚å‰`
    } else if (diffDays < 7) {
      return `${diffDays} å¤©å‰`
    } else {
      return formatDate(date)
    }
  }
  
  return {
    formatDate,
    formatTime,
    formatDateTime,
    formatRelative,
    locale
  }
}
```

## ç¿»è­¯æ–‡ä»¶çµæ§‹èˆ‡ç¯„ä¾‹

### å®Œæ•´ç¿»è­¯æ–‡ä»¶ç¯„ä¾‹
```json
// locales/zh-TW/common.json
{
  "app": {
    "name": "MickeyShop Beauty",
    "tagline": "ç¾éº—å¾é€™è£¡é–‹å§‹"
  },
  "actions": {
    "add": "æ·»åŠ ",
    "edit": "ç·¨è¼¯",
    "delete": "åˆªé™¤",
    "save": "å„²å­˜",
    "cancel": "å–æ¶ˆ",
    "confirm": "ç¢ºèª",
    "back": "è¿”å›",
    "continue": "ç¹¼çºŒ",
    "submit": "æäº¤",
    "search": "æœå°‹",
    "filter": "ç¯©é¸",
    "sort": "æ’åº",
    "loading": "è¼‰å…¥ä¸­...",
    "retry": "é‡è©¦"
  },
  "status": {
    "success": "æˆåŠŸ",
    "error": "éŒ¯èª¤", 
    "warning": "è­¦å‘Š",
    "info": "è³‡è¨Š",
    "pending": "å¾…è™•ç†",
    "completed": "å·²å®Œæˆ",
    "cancelled": "å·²å–æ¶ˆ"
  }
}
```

```json
// locales/zh-TW/products.json
{
  "title": "å•†å“",
  "categories": {
    "skincare": "è­·è†š",
    "haircare": "è­·é«®",
    "makeup": "åŒ–å¦å“",
    "fragrance": "é¦™æ°´",
    "tools": "ç¾å®¹å·¥å…·"
  },
  "filters": {
    "brand": "å“ç‰Œ",
    "price": "åƒ¹æ ¼",
    "rating": "è©•åˆ†",
    "availability": "åº«å­˜ç‹€æ…‹"
  },
  "details": {
    "description": "å•†å“æè¿°",
    "ingredients": "æˆåˆ†",
    "usage": "ä½¿ç”¨æ–¹æ³•",
    "specifications": "è¦æ ¼",
    "reviews": "è©•åƒ¹"
  },
  "stock": {
    "inStock": "ç¾è²¨",
    "outOfStock": "ç¼ºè²¨",
    "lowStock": "åº«å­˜ä¸è¶³",
    "preOrder": "é è³¼"
  }
}
```

### å‹•æ…‹ç¿»è­¯è¼‰å…¥
```js
// utils/translation-loader.js
export class TranslationLoader {
  constructor() {
    this.loadedNamespaces = new Set()
    this.loadingPromises = new Map()
  }
  
  async loadNamespace(namespace, language = 'zh-TW') {
    const key = `${language}-${namespace}`
    
    if (this.loadedNamespaces.has(key)) {
      return // å·²è¼‰å…¥
    }
    
    if (this.loadingPromises.has(key)) {
      return this.loadingPromises.get(key) // æ­£åœ¨è¼‰å…¥
    }
    
    const promise = this._fetchTranslation(namespace, language)
    this.loadingPromises.set(key, promise)
    
    try {
      const translations = await promise
      
      // åŠ è¼‰åˆ°i18n
      i18n.addResourceBundle(language, namespace, translations)
      this.loadedNamespaces.add(key)
      
      return translations
    } finally {
      this.loadingPromises.delete(key)
    }
  }
  
  async _fetchTranslation(namespace, language) {
    try {
      const response = await fetch(`/locales/${language}/${namespace}.json`)
      if (!response.ok) {
        throw new Error(`Failed to load ${namespace} for ${language}`)
      }
      return await response.json()
    } catch (error) {
      // ä½¿ç”¨çµ±ä¸€éŒ¯èª¤è™•ç†ç³»çµ±
      const { handleError } = await import('@/stores/error-handler')
      handleError.getState().handleError(error, {
        type: 'translation-load',
        namespace,
        language,
        retryCallback: () => this._fetchTranslation(namespace, language)
      })
      
      // è¿”å›ç©ºå°è±¡ä½œç‚ºå‚™ç”¨
      return {}
    }
  }
  
  // é è¼‰å…¥é—œéµå‘½åç©ºé–“
  async preloadCriticalNamespaces(language = 'zh-TW') {
    const critical = ['common', 'navigation', 'products']
    await Promise.all(
      critical.map(ns => this.loadNamespace(ns, language))
    )
  }
}

export const translationLoader = new TranslationLoader()
```

## SEOåœ‹éš›åŒ–å¯¦ç¾

### å¤šèªè¨€SEOçµ„ä»¶
```jsx
// components/SEOHead.jsx
import React from 'react'
import { Helmet } from 'react-helmet-async'
import { useTranslation } from 'react-i18next'
import { useLocale } from './LocaleProvider'

export const SEOHead = ({ 
  title, 
  description, 
  keywords,
  image,
  url,
  type = 'website' 
}) => {
  const { t } = useTranslation('seo')
  const { locale } = useLocale()
  
  const siteTitle = t('site.title', 'MickeyShop Beauty')
  const fullTitle = title ? `${title} | ${siteTitle}` : siteTitle
  const currentUrl = `${window.location.origin}/${locale}${url || ''}`
  
  return (
    <Helmet>
      {/* åŸºæœ¬SEO */}
      <html lang={locale} />
      <title>{fullTitle}</title>
      <meta name="description" content={description || t('site.description')} />
      <meta name="keywords" content={keywords || t('site.keywords')} />
      
      {/* Open Graph */}
      <meta property="og:title" content={fullTitle} />
      <meta property="og:description" content={description || t('site.description')} />
      <meta property="og:type" content={type} />
      <meta property="og:url" content={currentUrl} />
      <meta property="og:locale" content={locale} />
      <meta property="og:site_name" content={siteTitle} />
      {image && <meta property="og:image" content={image} />}
      
      {/* Twitter Card */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={fullTitle} />
      <meta name="twitter:description" content={description || t('site.description')} />
      {image && <meta name="twitter:image" content={image} />}
      
      {/* èªè¨€æ›¿ä»£é€£çµ */}
      <link rel="alternate" hrefLang="zh-TW" href={`${window.location.origin}/zh-TW${url || ''}`} />
      <link rel="alternate" hrefLang="en" href={`${window.location.origin}/en${url || ''}`} />
      <link rel="alternate" hrefLang="x-default" href={`${window.location.origin}/zh-TW${url || ''}`} />
      
      {/* Canonical URL */}
      <link rel="canonical" href={currentUrl} />
    </Helmet>
  )
}
```

### çµæ§‹åŒ–è³‡æ–™åœ‹éš›åŒ–
```js
// utils/structured-data.js
import { useTranslation } from 'react-i18next'
import { useLocale } from '@/components/LocaleProvider'

export const useStructuredData = () => {
  const { t } = useTranslation('seo')
  const { locale } = useLocale()
  
  const generateProductSchema = (product) => {
    return {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": product.name[locale] || product.name['zh-TW'],
      "description": product.description[locale] || product.description['zh-TW'],
      "image": product.images,
      "brand": {
        "@type": "Brand",
        "name": product.brand
      },
      "offers": {
        "@type": "Offer",
        "price": product.prices[locale === 'en' ? 'USD' : 'TWD'],
        "priceCurrency": locale === 'en' ? 'USD' : 'TWD',
        "availability": product.inStock ? 
          "https://schema.org/InStock" : 
          "https://schema.org/OutOfStock",
        "url": `${window.location.origin}/${locale}/product/${product.slug[locale]}`
      },
      "aggregateRating": product.rating ? {
        "@type": "AggregateRating",
        "ratingValue": product.rating.average,
        "reviewCount": product.rating.count
      } : undefined
    }
  }
  
  return {
    generateProductSchema,
    generateBreadcrumbSchema: (breadcrumbs) => ({
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": breadcrumbs.map((item, index) => ({
        "@type": "ListItem",
        "position": index + 1,
        "name": item.name,
        "item": `${window.location.origin}/${locale}${item.url}`
      }))
    })
  }
}
```

## è¡¨å–®é©—è­‰åœ‹éš›åŒ–

### åœ°å€åŒ–é©—è­‰è¦å‰‡
```js
// utils/validation-rules.js
import { useLocale } from '@/components/LocaleProvider'
import { useTranslation } from 'react-i18next'

export const useValidationRules = () => {
  const { locale } = useLocale()
  const { t } = useTranslation('forms')
  
  const LOCALE_PATTERNS = {
    'zh-TW': {
      phone: /^(\+886|0)?[0-9]{8,10}$/,
      idNumber: /^[A-Z][1-2]\d{8}$/,
      postcode: /^\d{3,5}$/,
      bankAccount: /^\d{10,16}$/
    },
    'en': {
      phone: /^(\+1)?[0-9]{10}$/,
      ssn: /^\d{3}-\d{2}-\d{4}$/,
      zipcode: /^\d{5}(-\d{4})?$/,
      routingNumber: /^\d{9}$/
    }
  }
  
  const validatePhone = (value) => {
    const pattern = LOCALE_PATTERNS[locale]?.phone
    if (!pattern || !value) return false
    return pattern.test(value)
  }
  
  const validatePostalCode = (value) => {
    const pattern = LOCALE_PATTERNS[locale]?.postcode || LOCALE_PATTERNS[locale]?.zipcode
    if (!pattern || !value) return false
    return pattern.test(value)
  }
  
  const getPhoneErrorMessage = () => {
    return locale === 'zh-TW' ? 
      t('validation.phone.invalid', 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼') :
      t('validation.phone.invalid', 'Please enter a valid phone number')
  }
  
  return {
    validatePhone,
    validatePostalCode,
    getPhoneErrorMessage,
    patterns: LOCALE_PATTERNS[locale] || {}
  }
}
```

## è·¯ç”±å™¨æ•´åˆ

### åœ‹éš›åŒ–è·¯ç”±é…ç½®
```jsx
// router/index.jsx
import { createBrowserRouter } from 'react-router-dom'
import { LocaleProvider } from '@/components/LocaleProvider'
import { LocaleRedirect } from '@/components/LocaleRedirect'

// è‡ªå‹•é‡å°å‘çµ„ä»¶
const LocaleRedirect = () => {
  const savedLocale = localStorage.getItem('locale-preference')
  const browserLocale = navigator.language
  
  // æ±ºå®šé‡å°å‘çš„èªè¨€
  let targetLocale = 'zh-TW'
  
  if (savedLocale && ['zh-TW', 'en'].includes(savedLocale)) {
    targetLocale = savedLocale
  } else if (browserLocale?.startsWith('en')) {
    targetLocale = 'en'
  }
  
  return <Navigate to={`/${targetLocale}`} replace />
}

export const router = createBrowserRouter([
  {
    path: '/',
    element: <LocaleRedirect />
  },
  {
    path: '/:locale',
    element: <LocaleProvider><App /></LocaleProvider>,
    children: [
      // ä¸»è¦é é¢è·¯ç”±
      { index: true, element: <HomePage /> },
      { path: 'products', element: <ProductsPage /> },
      { path: 'product/:category/:productName', element: <ProductDetailPage /> },
      
      // ç”¨æˆ¶è·¯ç”±  
      { path: 'user/profile', element: <ProfilePage /> },
      { path: 'user/orders', element: <OrdersPage /> },
      { path: 'user/wishlist', element: <WishlistPage /> },
      
      // è³¼ç‰©æµç¨‹
      { path: 'cart', element: <CartPage /> },
      { path: 'checkout', element: <CheckoutPage /> },
      { path: 'checkout/payment', element: <PaymentPage /> },
      
      // æœç´¢å’Œåˆ†é¡
      { path: 'search/:keywords', element: <SearchPage /> },
      { path: 'trending', element: <TrendingPage /> }
    ]
  }
])
```

## æ•ˆèƒ½å„ªåŒ–

### ç¿»è­¯é è¼‰å…¥ç­–ç•¥
```js
// hooks/useTranslationPreloader.js
import { useEffect } from 'react'
import { translationLoader } from '@/utils/translation-loader'
import { useLocale } from '@/components/LocaleProvider'

export const useTranslationPreloader = () => {
  const { locale } = useLocale()
  
  useEffect(() => {
    // é è¼‰å…¥ç•¶å‰é é¢å¯èƒ½éœ€è¦çš„ç¿»è­¯
    const preloadForRoute = async (route) => {
      const routeNamespaceMap = {
        '/products': ['products', 'filters'],
        '/cart': ['cart', 'checkout'],
        '/user': ['user', 'forms'],
        '/search': ['products', 'search']
      }
      
      const namespaces = routeNamespaceMap[route] || []
      await Promise.all(
        namespaces.map(ns => translationLoader.loadNamespace(ns, locale))
      )
    }
    
    // ç›£è½è·¯ç”±è®ŠåŒ–ä¸¦é è¼‰å…¥
    const currentRoute = window.location.pathname.replace(/^\/(zh-TW|en)/, '')
    preloadForRoute(currentRoute)
    
  }, [locale])
}
```