# 國際化實現策略

## 支援語言與貨幣

### 語言支援
- **主要語言**: 繁體中文 (zh-TW)
- **次要語言**: 英文 (en)
- **擴展性**: 支援未來新增語言

### 貨幣支援
- **主要貨幣**: 新台幣 (TWD)
- **次要貨幣**: 美金 (USD)
- **擴展性**: 支援未來新增貨幣

## 地區檢測策略

### Cloudflare地理位置檢測
```js
// 檢測優先序
1. URL 參數 (?lang=zh-TW&currency=TWD)
2. localStorage 儲存的用戶偏好
3. Cloudflare request.cf.country
4. Accept-Language HTTP header
5. 預設值 (zh-TW/TWD)
```

### 國家映射配置
```js
const REGION_MAPPING = {
  'TW': { locale: 'zh-TW', currency: 'TWD', phonePrefix: '+886' },
  'US': { locale: 'en', currency: 'USD', phonePrefix: '+1' },
  'CN': { locale: 'zh-TW', currency: 'TWD', phonePrefix: '+86' },
  'HK': { locale: 'zh-TW', currency: 'TWD', phonePrefix: '+852' },
  'SG': { locale: 'en', currency: 'USD', phonePrefix: '+65' }
}
```

## 路由國際化

### URL結構規範
- **語言前綴**: 所有路由包含 `:locale` 前綴
- **支援語言**: `zh-TW`, `en`
- **預設語言**: 根據Cloudflare地理檢測
- **格式**: `/:locale/path` (例: `example.com/zh-TW/products`)
- **支援路由**: 所有前台頁面
- **根路徑處理**: 自動重導向到檢測到的語言

### 完整路由架構

#### 商品路由
```
/:locale/product/商品分類/商品名稱
```
- **商品分類**: 後台管理員可設定
- **商品名稱**: 後台管理員可設定
- **範例**: `/zh-TW/product/skincare/蘭蔻小黑瓶精華`

#### 用戶路由
```
/:locale/user/頁面名稱
```
- **範例**: `/zh-TW/user/profile`, `/zh-TW/user/orders`

#### 搜索路由
```
/:locale/search/keywords
```
- **基礎搜索**: `/zh-TW/search/保濕精華`
- **SEO友好篩選**: `/zh-TW/search/保濕精華/brand-蘭蔻-雅詩蘭黛/price-1000-5000`

#### 購物流程路由
```
/:locale/cart → /:locale/checkout → /:locale/checkout/payment → /:locale/checkout/success
```

### 導航架構設計

#### 桌面版頂部導航列
**左側功能區**:
- 幣種切換
- 語言切換  
- 搜尋框

**右側導航區** (與手機版底部導航一致):
1. **首頁**: `/:locale/`
2. **熱門商品**: `/:locale/trending`
3. **收藏清單**: `/:locale/user/wishlist`
4. **通知**: `/:locale/user/notifications`
5. **購物車**: `/:locale/cart`
6. **會員中心**: `/:locale/user/profile`

#### 手機版導航設計

**頂部導航列**:
- 幣種切換
- 語言切換
- 搜尋框

**底部導航列**:
1. **首頁**: `/:locale/`
2. **熱門商品**: `/:locale/trending`
3. **收藏清單**: `/:locale/user/wishlist`
4. **通知**: `/:locale/user/notifications`
5. **購物車**: `/:locale/cart`
6. **會員中心**: `/:locale/user/profile`

### React Router配置
```js
const routes = [
  {
    path: '/:locale',
    element: <I18nWrapper />,
    children: [
      // 首頁與基本頁面
      { path: '', element: <HomePage /> },
      { path: 'trending', element: <TrendingPage /> },
      
      // 商品相關路由
      { path: 'product/:category/:productName', element: <ProductDetailPage /> },
      { path: 'products', element: <ProductsPage /> },
      { path: 'products/:category', element: <CategoryPage /> },
      
      // 搜索路由
      { path: 'search/:keywords', element: <SearchPage /> },
      { path: 'search/:keywords/*', element: <SearchPage /> }, // 包含篩選參數
      
      // 用戶路由
      { path: 'user/profile', element: <ProfilePage /> },
      { path: 'user/orders', element: <OrdersPage /> },
      { path: 'user/wishlist', element: <WishlistPage /> },
      { path: 'user/notifications', element: <NotificationsPage /> },
      
      // 購物流程路由
      { path: 'cart', element: <CartPage /> },
      { path: 'checkout', element: <CheckoutPage /> },
      { path: 'checkout/payment', element: <PaymentPage /> },
      { path: 'checkout/success', element: <SuccessPage /> }
    ]
  },
  // 根路徑自動重導向
  { path: '/', element: <LocaleRedirect /> }
]
```

### 路由策略
- **統一導航**: 桌面版右側導航與手機版底部導航完全一致，確保跨設備的操作一致性
- **SEO優化**: 
  - **路徑編碼**: 使用路徑而非URL參數
  - **語言前綴**: 便於搜索引擎理解多語言內容
  - **靜態生成**: 支持熱門頁面SSG

## React-i18next 架構

### 技術選型
- **核心庫**: react-i18next
- **版本**: ^13.0.0
- **載入策略**: 按需載入
- **檢測器**: i18next-browser-languagedetector
- **後端載入器**: i18next-http-backend

### 核心功能
- 翻譯文件動態載入
- 參數插值與複數形式
- 命名空間按需載入
- 語言自動檢測
- 完整的回退語言機制
- TypeScript型別安全

### 翻譯文件結構
```
locales/
├── zh-TW/
│   ├── common.json          # 通用文字
│   ├── navigation.json      # 導航選單
│   ├── products.json        # 商品相關
│   ├── cart.json           # 購物車
│   ├── checkout.json       # 結帳流程
│   ├── user.json           # 用戶相關
│   ├── forms.json          # 表單驗證
│   ├── errors.json         # 錯誤訊息
│   ├── currency.json       # 貨幣顯示
│   └── seo.json           # SEO元資料
└── en/
    └── (相同結構)
```

## 貨幣處理策略

### API貨幣支援
- **數據來源**: API返回所有貨幣價格
- **匯率更新**: 每日更新固定匯率
- **價格顯示**: 不顯示原價貨幣

### 貨幣格式配置
```json
{
  "TWD": {
    "symbol": "NT$",
    "code": "TWD",
    "decimals": 0,
    "position": "before"
  },
  "USD": {
    "symbol": "$",
    "code": "USD", 
    "decimals": 2,
    "position": "before"
  }
}
```

## 表單驗證國際化

### 地區驗證規則
```js
const VALIDATION_RULES = {
  'zh-TW': {
    phone: /^(\+886|0)?[0-9]{8,10}$/,
    idNumber: /^[A-Z][1-2]\d{8}$/,
    postcode: /^\d{3,5}$/
  },
  'en': {
    phone: /^(\+1)?[0-9]{10}$/,
    ssn: /^\d{3}-\d{2}-\d{4}$/,
    zipcode: /^\d{5}(-\d{4})?$/
  }
}
```

### 動態驗證載入
- 根據用戶選擇的電話國碼動態載入驗證規則
- 支援地址格式驗證
- 身份證號碼格式驗證

## 日期時間格式

### 地區格式配置
```js
const DATETIME_FORMATS = {
  'zh-TW': {
    date: 'YYYY/MM/DD',
    time: 'HH:mm',
    datetime: 'YYYY/MM/DD HH:mm'
  },
  'en': {
    date: 'MM/DD/YYYY',
    time: 'hh:mm A',
    datetime: 'MM/DD/YYYY hh:mm A'
  }
}
```

## API國際化整合

### 請求頭設定
```js
apiClient.interceptors.request.use((config) => {
  config.headers['Accept-Language'] = locale
  config.headers['Accept-Currency'] = currency
  return config
})
```

### 內容翻譯範圍
- 所有UI介面文字
- 商品名稱與描述
- 品牌名稱
- 分類名稱
- SEO元資料

## React-i18next 實際配置

### 初始化配置
```js
// i18n/index.js
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import Backend from 'i18next-http-backend'
import LanguageDetector from 'i18next-browser-languagedetector'

i18n
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    lng: 'zh-TW',
    fallbackLng: 'zh-TW',
    
    // 按需載入設定
    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json'
    },
    
    // 命名空間設定
    ns: ['common'],
    defaultNS: 'common',
    
    // 性能優化
    load: 'currentOnly', // 只載入當前語言
    preload: false, // 不預載入
    
    // Cloudflare地理檢測整合
    detection: {
      order: ['querystring', 'localStorage', 'cookie', 'navigator'],
      lookupQuerystring: 'lang',
      lookupLocalStorage: 'locale-preference',
      lookupCookie: 'locale',
      caches: ['localStorage', 'cookie']
    },
    
    interpolation: {
      escapeValue: false
    }
  })

export default i18n
```

### Hook使用範例
```jsx
// 基礎使用
const { t } = useTranslation()

// 命名空間按需載入
const { t } = useTranslation(['products', 'cart'])

// 載入狀態處理
const { t, ready } = useTranslation('products')
if (!ready) return <Loading />

// 複數形式
t('itemCount', { count: 5 }) // "5 items" 或 "5 個項目"
```

### 語言切換實現
```js
// utils/language-switcher.js
import i18n from '@/i18n'
import { useNavigate } from 'react-router-dom'

export const changeLanguage = async (lng, navigate) => {
  // 更新i18n語言
  await i18n.changeLanguage(lng)
  
  // 存儲用戶偏好
  localStorage.setItem('locale-preference', lng)
  document.cookie = `locale=${lng}; path=/; max-age=31536000` // 1年
  
  // 更新HTML lang屬性
  document.documentElement.lang = lng
  
  // 更新路由（使用React Router）
  const currentPath = window.location.pathname
  const pathWithoutLocale = currentPath.replace(/^\/(zh-TW|en)/, '')
  const newPath = `/${lng}${pathWithoutLocale}`
  
  if (navigate) {
    navigate(newPath, { replace: true })
  } else {
    window.location.href = newPath
  }
  
  // 觸發全局語言變更事件
  window.dispatchEvent(new CustomEvent('localeChange', { detail: lng }))
}

// React Hook for language switching
import { useNavigate } from 'react-router-dom'
export const useLanguageSwitcher = () => {
  const navigate = useNavigate()
  
  return {
    switchLanguage: (lng) => changeLanguage(lng, navigate),
    currentLanguage: i18n.language
  }
}
```

## 翻譯內容管理

### 管理策略
- **維護方式**: 後台管理頁維護
- **管理範圍**: 所有前台文字
- **後台語言**: 只支援繁體中文
- **權限控制**: 管理員權限

### 內容同步
- 新增語言時自動創建對應翻譯文件
- 支援批量翻譯匯入匯出
- 缺失翻譯自動回退到預設語言
- 支援 react-i18next 的 saveMissing 功能

### TypeScript 型別安全
```ts
// types/i18next.d.ts
import 'react-i18next'
import commonZhTW from '@/locales/zh-TW/common.json'
import productsZhTW from '@/locales/zh-TW/products.json'
import cartZhTW from '@/locales/zh-TW/cart.json'
import checkoutZhTW from '@/locales/zh-TW/checkout.json'
import userZhTW from '@/locales/zh-TW/user.json'
import formsZhTW from '@/locales/zh-TW/forms.json'

declare module 'react-i18next' {
  interface CustomTypeOptions {
    defaultNS: 'common'
    resources: {
      common: typeof commonZhTW
      navigation: typeof navigationZhTW
      products: typeof productsZhTW
      cart: typeof cartZhTW
      checkout: typeof checkoutZhTW
      user: typeof userZhTW
      forms: typeof formsZhTW
      errors: typeof errorsZhTW
      currency: typeof currencyZhTW
      seo: typeof seoZhTW
    }
  }
}
```

## 實現組件與Hook

### LocaleProvider組件
```jsx
// components/LocaleProvider.jsx
import React, { createContext, useContext, useEffect, useState } from 'react'
import { useParams, Navigate } from 'react-router-dom'
import { ConfigProvider } from 'antd'
import zhTW from 'antd/locale/zh_TW'
import enUS from 'antd/locale/en_US'
import { useTranslation } from 'react-i18next'

const LocaleContext = createContext()

const SUPPORTED_LOCALES = ['zh-TW', 'en']
const LOCALE_CONFIG = {
  'zh-TW': {
    antdLocale: zhTW,
    dateFormat: 'YYYY/MM/DD',
    timeFormat: 'HH:mm',
    numberFormat: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
    currencySymbol: 'NT$'
  },
  'en': {
    antdLocale: enUS,
    dateFormat: 'MM/DD/YYYY', 
    timeFormat: 'hh:mm A',
    numberFormat: { minimumFractionDigits: 2, maximumFractionDigits: 2 },
    currencySymbol: '$'
  }
}

export const LocaleProvider = ({ children }) => {
  const { locale } = useParams()
  const { i18n } = useTranslation()
  const [currentLocale, setCurrentLocale] = useState(locale || 'zh-TW')
  
  // 驗證語言參數有效性
  if (!SUPPORTED_LOCALES.includes(locale)) {
    return <Navigate to="/zh-TW" replace />
  }
  
  useEffect(() => {
    if (locale && locale !== i18n.language) {
      i18n.changeLanguage(locale)
      setCurrentLocale(locale)
      document.documentElement.lang = locale
    }
  }, [locale, i18n])
  
  const localeConfig = LOCALE_CONFIG[currentLocale]
  
  const value = {
    locale: currentLocale,
    setLocale: setCurrentLocale,
    config: localeConfig,
    isRTL: false // 可擴展支援阿拉伯語等RTL語言
  }
  
  return (
    <LocaleContext.Provider value={value}>
      <ConfigProvider locale={localeConfig.antdLocale}>
        {children}
      </ConfigProvider>
    </LocaleContext.Provider>
  )
}

export const useLocale = () => {
  const context = useContext(LocaleContext)
  if (!context) {
    // 使用統一錯誤處理系統
    import('@/stores/error-handler').then(({ useErrorHandler }) => {
      useErrorHandler.getState().handleError(
        new Error('useLocale must be used within LocaleProvider'),
        { type: 'hook-usage', hook: 'useLocale' }
      )
    })
    throw new Error('useLocale must be used within LocaleProvider')
  }
  return context
}
```

### 語言切換組件
```jsx
// components/LanguageSwitcher.jsx
import React from 'react'
import { Select, Button } from 'antd'
import { GlobalOutlined } from '@ant-design/icons'
import { useLanguageSwitcher } from '@/utils/language-switcher'
import { useTranslation } from 'react-i18next'

const LANGUAGE_OPTIONS = [
  { value: 'zh-TW', label: '繁體中文', flag: '🇹🇼' },
  { value: 'en', label: 'English', flag: '🇺🇸' }
]

export const LanguageSwitcher = ({ type = 'select' }) => {
  const { switchLanguage, currentLanguage } = useLanguageSwitcher()
  const { t } = useTranslation('common')
  
  if (type === 'dropdown') {
    return (
      <Select
        value={currentLanguage}
        onChange={switchLanguage}
        suffixIcon={<GlobalOutlined />}
        style={{ minWidth: 120 }}
      >
        {LANGUAGE_OPTIONS.map(option => (
          <Select.Option key={option.value} value={option.value}>
            <span style={{ marginRight: 8 }}>{option.flag}</span>
            {option.label}
          </Select.Option>
        ))}
      </Select>
    )
  }
  
  return (
    <div className="language-switcher">
      {LANGUAGE_OPTIONS.map(option => (
        <Button
          key={option.value}
          type={currentLanguage === option.value ? 'primary' : 'text'}
          size="small"
          onClick={() => switchLanguage(option.value)}
        >
          <span style={{ marginRight: 4 }}>{option.flag}</span>
          {option.label}
        </Button>
      ))}
    </div>
  )
}
```

### 貨幣格式化Hook
```js
// hooks/useCurrency.js
import { useLocale } from '@/components/LocaleProvider'
import { useTranslation } from 'react-i18next'

export const useCurrency = () => {
  const { locale, config } = useLocale()
  const { t } = useTranslation('currency')
  
  const formatCurrency = (amount, currency = 'TWD') => {
    const currencySymbols = {
      'TWD': 'NT$',
      'USD': '$'
    }
    
    const symbol = currencySymbols[currency] || config.currencySymbol
    const formattedAmount = new Intl.NumberFormat(locale, {
      ...config.numberFormat,
      style: 'decimal'
    }).format(amount)
    
    return `${symbol}${formattedAmount}`
  }
  
  const formatPrice = (prices, targetCurrency = 'TWD') => {
    // prices: { TWD: 1200, USD: 40 }
    const amount = prices[targetCurrency]
    return formatCurrency(amount, targetCurrency)
  }
  
  return {
    formatCurrency,
    formatPrice,
    currentCurrency: locale === 'en' ? 'USD' : 'TWD'
  }
}
```

### 日期格式化Hook  
```js
// hooks/useDateTime.js
import { useLocale } from '@/components/LocaleProvider'
import dayjs from 'dayjs'

export const useDateTime = () => {
  const { locale, config } = useLocale()
  
  const formatDate = (date) => {
    return dayjs(date).format(config.dateFormat)
  }
  
  const formatTime = (date) => {
    return dayjs(date).format(config.timeFormat)
  }
  
  const formatDateTime = (date) => {
    return dayjs(date).format(`${config.dateFormat} ${config.timeFormat}`)
  }
  
  const formatRelative = (date) => {
    const now = dayjs()
    const target = dayjs(date)
    const diffHours = now.diff(target, 'hour')
    const diffDays = now.diff(target, 'day')
    
    if (diffHours < 24) {
      return `${diffHours} 小時前`
    } else if (diffDays < 7) {
      return `${diffDays} 天前`
    } else {
      return formatDate(date)
    }
  }
  
  return {
    formatDate,
    formatTime,
    formatDateTime,
    formatRelative,
    locale
  }
}
```

## 翻譯文件結構與範例

### 完整翻譯文件範例
```json
// locales/zh-TW/common.json
{
  "app": {
    "name": "MickeyShop Beauty",
    "tagline": "美麗從這裡開始"
  },
  "actions": {
    "add": "添加",
    "edit": "編輯",
    "delete": "刪除",
    "save": "儲存",
    "cancel": "取消",
    "confirm": "確認",
    "back": "返回",
    "continue": "繼續",
    "submit": "提交",
    "search": "搜尋",
    "filter": "篩選",
    "sort": "排序",
    "loading": "載入中...",
    "retry": "重試"
  },
  "status": {
    "success": "成功",
    "error": "錯誤", 
    "warning": "警告",
    "info": "資訊",
    "pending": "待處理",
    "completed": "已完成",
    "cancelled": "已取消"
  }
}
```

```json
// locales/zh-TW/products.json
{
  "title": "商品",
  "categories": {
    "skincare": "護膚",
    "haircare": "護髮",
    "makeup": "化妝品",
    "fragrance": "香水",
    "tools": "美容工具"
  },
  "filters": {
    "brand": "品牌",
    "price": "價格",
    "rating": "評分",
    "availability": "庫存狀態"
  },
  "details": {
    "description": "商品描述",
    "ingredients": "成分",
    "usage": "使用方法",
    "specifications": "規格",
    "reviews": "評價"
  },
  "stock": {
    "inStock": "現貨",
    "outOfStock": "缺貨",
    "lowStock": "庫存不足",
    "preOrder": "預購"
  }
}
```

### 動態翻譯載入
```js
// utils/translation-loader.js
export class TranslationLoader {
  constructor() {
    this.loadedNamespaces = new Set()
    this.loadingPromises = new Map()
  }
  
  async loadNamespace(namespace, language = 'zh-TW') {
    const key = `${language}-${namespace}`
    
    if (this.loadedNamespaces.has(key)) {
      return // 已載入
    }
    
    if (this.loadingPromises.has(key)) {
      return this.loadingPromises.get(key) // 正在載入
    }
    
    const promise = this._fetchTranslation(namespace, language)
    this.loadingPromises.set(key, promise)
    
    try {
      const translations = await promise
      
      // 加載到i18n
      i18n.addResourceBundle(language, namespace, translations)
      this.loadedNamespaces.add(key)
      
      return translations
    } finally {
      this.loadingPromises.delete(key)
    }
  }
  
  async _fetchTranslation(namespace, language) {
    try {
      const response = await fetch(`/locales/${language}/${namespace}.json`)
      if (!response.ok) {
        throw new Error(`Failed to load ${namespace} for ${language}`)
      }
      return await response.json()
    } catch (error) {
      // 使用統一錯誤處理系統
      const { handleError } = await import('@/stores/error-handler')
      handleError.getState().handleError(error, {
        type: 'translation-load',
        namespace,
        language,
        retryCallback: () => this._fetchTranslation(namespace, language)
      })
      
      // 返回空對象作為備用
      return {}
    }
  }
  
  // 預載入關鍵命名空間
  async preloadCriticalNamespaces(language = 'zh-TW') {
    const critical = ['common', 'navigation', 'products']
    await Promise.all(
      critical.map(ns => this.loadNamespace(ns, language))
    )
  }
}

export const translationLoader = new TranslationLoader()
```

## SEO國際化實現

### 多語言SEO組件
```jsx
// components/SEOHead.jsx
import React from 'react'
import { Helmet } from 'react-helmet-async'
import { useTranslation } from 'react-i18next'
import { useLocale } from './LocaleProvider'

export const SEOHead = ({ 
  title, 
  description, 
  keywords,
  image,
  url,
  type = 'website' 
}) => {
  const { t } = useTranslation('seo')
  const { locale } = useLocale()
  
  const siteTitle = t('site.title', 'MickeyShop Beauty')
  const fullTitle = title ? `${title} | ${siteTitle}` : siteTitle
  const currentUrl = `${window.location.origin}/${locale}${url || ''}`
  
  return (
    <Helmet>
      {/* 基本SEO */}
      <html lang={locale} />
      <title>{fullTitle}</title>
      <meta name="description" content={description || t('site.description')} />
      <meta name="keywords" content={keywords || t('site.keywords')} />
      
      {/* Open Graph */}
      <meta property="og:title" content={fullTitle} />
      <meta property="og:description" content={description || t('site.description')} />
      <meta property="og:type" content={type} />
      <meta property="og:url" content={currentUrl} />
      <meta property="og:locale" content={locale} />
      <meta property="og:site_name" content={siteTitle} />
      {image && <meta property="og:image" content={image} />}
      
      {/* Twitter Card */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={fullTitle} />
      <meta name="twitter:description" content={description || t('site.description')} />
      {image && <meta name="twitter:image" content={image} />}
      
      {/* 語言替代連結 */}
      <link rel="alternate" hrefLang="zh-TW" href={`${window.location.origin}/zh-TW${url || ''}`} />
      <link rel="alternate" hrefLang="en" href={`${window.location.origin}/en${url || ''}`} />
      <link rel="alternate" hrefLang="x-default" href={`${window.location.origin}/zh-TW${url || ''}`} />
      
      {/* Canonical URL */}
      <link rel="canonical" href={currentUrl} />
    </Helmet>
  )
}
```

### 結構化資料國際化
```js
// utils/structured-data.js
import { useTranslation } from 'react-i18next'
import { useLocale } from '@/components/LocaleProvider'

export const useStructuredData = () => {
  const { t } = useTranslation('seo')
  const { locale } = useLocale()
  
  const generateProductSchema = (product) => {
    return {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": product.name[locale] || product.name['zh-TW'],
      "description": product.description[locale] || product.description['zh-TW'],
      "image": product.images,
      "brand": {
        "@type": "Brand",
        "name": product.brand
      },
      "offers": {
        "@type": "Offer",
        "price": product.prices[locale === 'en' ? 'USD' : 'TWD'],
        "priceCurrency": locale === 'en' ? 'USD' : 'TWD',
        "availability": product.inStock ? 
          "https://schema.org/InStock" : 
          "https://schema.org/OutOfStock",
        "url": `${window.location.origin}/${locale}/product/${product.slug[locale]}`
      },
      "aggregateRating": product.rating ? {
        "@type": "AggregateRating",
        "ratingValue": product.rating.average,
        "reviewCount": product.rating.count
      } : undefined
    }
  }
  
  return {
    generateProductSchema,
    generateBreadcrumbSchema: (breadcrumbs) => ({
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": breadcrumbs.map((item, index) => ({
        "@type": "ListItem",
        "position": index + 1,
        "name": item.name,
        "item": `${window.location.origin}/${locale}${item.url}`
      }))
    })
  }
}
```

## 表單驗證國際化

### 地區化驗證規則
```js
// utils/validation-rules.js
import { useLocale } from '@/components/LocaleProvider'
import { useTranslation } from 'react-i18next'

export const useValidationRules = () => {
  const { locale } = useLocale()
  const { t } = useTranslation('forms')
  
  const LOCALE_PATTERNS = {
    'zh-TW': {
      phone: /^(\+886|0)?[0-9]{8,10}$/,
      idNumber: /^[A-Z][1-2]\d{8}$/,
      postcode: /^\d{3,5}$/,
      bankAccount: /^\d{10,16}$/
    },
    'en': {
      phone: /^(\+1)?[0-9]{10}$/,
      ssn: /^\d{3}-\d{2}-\d{4}$/,
      zipcode: /^\d{5}(-\d{4})?$/,
      routingNumber: /^\d{9}$/
    }
  }
  
  const validatePhone = (value) => {
    const pattern = LOCALE_PATTERNS[locale]?.phone
    if (!pattern || !value) return false
    return pattern.test(value)
  }
  
  const validatePostalCode = (value) => {
    const pattern = LOCALE_PATTERNS[locale]?.postcode || LOCALE_PATTERNS[locale]?.zipcode
    if (!pattern || !value) return false
    return pattern.test(value)
  }
  
  const getPhoneErrorMessage = () => {
    return locale === 'zh-TW' ? 
      t('validation.phone.invalid', '請輸入有效的手機號碼') :
      t('validation.phone.invalid', 'Please enter a valid phone number')
  }
  
  return {
    validatePhone,
    validatePostalCode,
    getPhoneErrorMessage,
    patterns: LOCALE_PATTERNS[locale] || {}
  }
}
```

## 路由器整合

### 國際化路由配置
```jsx
// router/index.jsx
import { createBrowserRouter } from 'react-router-dom'
import { LocaleProvider } from '@/components/LocaleProvider'
import { LocaleRedirect } from '@/components/LocaleRedirect'

// 自動重導向組件
const LocaleRedirect = () => {
  const savedLocale = localStorage.getItem('locale-preference')
  const browserLocale = navigator.language
  
  // 決定重導向的語言
  let targetLocale = 'zh-TW'
  
  if (savedLocale && ['zh-TW', 'en'].includes(savedLocale)) {
    targetLocale = savedLocale
  } else if (browserLocale?.startsWith('en')) {
    targetLocale = 'en'
  }
  
  return <Navigate to={`/${targetLocale}`} replace />
}

export const router = createBrowserRouter([
  {
    path: '/',
    element: <LocaleRedirect />
  },
  {
    path: '/:locale',
    element: <LocaleProvider><App /></LocaleProvider>,
    children: [
      // 主要頁面路由
      { index: true, element: <HomePage /> },
      { path: 'products', element: <ProductsPage /> },
      { path: 'product/:category/:productName', element: <ProductDetailPage /> },
      
      // 用戶路由  
      { path: 'user/profile', element: <ProfilePage /> },
      { path: 'user/orders', element: <OrdersPage /> },
      { path: 'user/wishlist', element: <WishlistPage /> },
      
      // 購物流程
      { path: 'cart', element: <CartPage /> },
      { path: 'checkout', element: <CheckoutPage /> },
      { path: 'checkout/payment', element: <PaymentPage /> },
      
      // 搜索和分類
      { path: 'search/:keywords', element: <SearchPage /> },
      { path: 'trending', element: <TrendingPage /> }
    ]
  }
])
```

## 效能優化

### 翻譯預載入策略
```js
// hooks/useTranslationPreloader.js
import { useEffect } from 'react'
import { translationLoader } from '@/utils/translation-loader'
import { useLocale } from '@/components/LocaleProvider'

export const useTranslationPreloader = () => {
  const { locale } = useLocale()
  
  useEffect(() => {
    // 預載入當前頁面可能需要的翻譯
    const preloadForRoute = async (route) => {
      const routeNamespaceMap = {
        '/products': ['products', 'filters'],
        '/cart': ['cart', 'checkout'],
        '/user': ['user', 'forms'],
        '/search': ['products', 'search']
      }
      
      const namespaces = routeNamespaceMap[route] || []
      await Promise.all(
        namespaces.map(ns => translationLoader.loadNamespace(ns, locale))
      )
    }
    
    // 監聽路由變化並預載入
    const currentRoute = window.location.pathname.replace(/^\/(zh-TW|en)/, '')
    preloadForRoute(currentRoute)
    
  }, [locale])
}
```